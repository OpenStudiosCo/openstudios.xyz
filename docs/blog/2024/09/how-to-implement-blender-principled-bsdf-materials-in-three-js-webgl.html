<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="We are Open Studios. Perth based digital production studio."><title>How to implement Blender Principled BSDF Materials in Three.jsÂ (WebGL)</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png"><link rel="manifest" href="/assets/favicon/site.webmanifest" crossorigin="use-credentials"><link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#000000"><link rel="stylesheet" href="/assets/css/keen-slider.min.css"><script async src="/assets/js/keen-slider.js"></script><link rel="stylesheet" href="/assets/css/parvus.min.css"><script src="/assets/js/parvus.min.js"></script><link rel="stylesheet" href="/assets/css/1999.css"><script src="https://www.google.com/recaptcha/api.js"></script><link rel="canonical" href="https://openstudios.xyz/blog/2024/09/how-to-implement-blender-principled-bsdf-materials-in-three-js-webgl.html"><meta property="og:title"><meta property="og:description" content="Explore our digital studio retrospectives, project updates and technical guides. Gain insights into our process, expertise and abilities."><meta property="og:type" content="article"><meta property="og:image" content="https://openstudios.xyz//assets/blog/2024/09/Screenshot-2024-09-21-042909-Large-edited.png"><meta property="og:image:width" content="1024"><meta property="og:image:height" content="768"><meta name="twitter:title"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:description" content="Explore our digital studio retrospectives, project updates and technical guides. Gain insights into our process, expertise and abilities."><meta name="twitter:image" content="https://openstudios.xyz//assets/blog/2024/09/Screenshot-2024-09-21-042909-Large-edited.png"><script async src="https://www.googletagmanager.com/gtag/js?id=AW-983760722"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'AW-983760722');</script><style>#page-wrapper {
    position: relative;
    z-index: 2;
}
#webgl-wrapper {
    overflow: hidden;
    position: absolute;
    z-index: 1;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}
#loader_symbols {
    display: block;
    position:absolute;
    top:0;
    left:0;
    z-index: 2;
}

body {
    background-color: #000;
    margin: 0;
    padding: 0;
}
#webgl {
    display: none;
    opacity: 0;
}
#pageOverlay,
#webgl {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    display: block;
}
#pageOverlay {
    border: 0 none;
    display: none;
    z-index: 10000;
}
#pokematrixSign,
#exitSign {
    background: black;
    font-weight: bold;
    color: #fff;
    box-shadow: 0px 0px 5px 5px #00DD00;
    text-shadow: 2.5px 2.5px 5px #999;
    cursor: pointer;
    border: solid 1px #00DD00;
    border-radius: 1rem;
    padding: 0.5rem;
    position: fixed;
    top: 0;
    right: 0;
    z-index: 10001;
    padding-top: 1.75rem;
    padding-right: 1.75rem;
    margin-right: -1rem;
    margin-top: -1rem;
}
#pokematrixSign img,
#exitSign img {
    max-width: min(80px, 15vw);
    height: auto;
}
#pokematrixSign:active,
#pokematrixSign:focus,
#pokematrixSign:hover,
#exitSign:active,
#exitSign:focus,
#exitSign:hover {
    box-shadow: 0px 0px 7.5px 7.5px #00FF00;
    border-color: #00FF00;
}

#pokematrixSign {
    opacity: 0;
    cursor: pointer;
    z-index: 10003;
}
#exitSign {
    display: none;
}
#pokematrixImage,
#pokematrixCanvas {
    border-radius: 1rem;
    height: auto;
    position: fixed;
    right: 0;
    top: 0;
    z-index: 10002;
}
#pokematrixImage {
    top: 13rem;
}

@media screen and (min-width: 640px) {
    #pokematrixSign,
    #exitSign {
        padding: 1rem;
        margin-top: 0rem;
        margin-right: 0rem;
        top: 2rem;
        right: 3rem;
    }
     #pokematrixImage,
    #pokematrixCanvas {
        right: calc(3rem - 5px);
        top: calc(2rem - 5px);
    }
}</style></head><body onload="_init( 3000 );"><noscript><style>h1#loadingSign { display: none }</style></noscript><div id="page-wrapper"><div class="header_bg"></div><div class="header" role="banner"><div class="h1"><a href="/" title="Home"><img src="/assets/images/logo-wide.png" alt="Logo"></a></div></div><div class="menu" role="navigation"><ul role="menu"><li role="presentation"><a href="/about_us.html" role="menuitem">About Us</a></li><li role="presentation"><a href="/services.html" role="menuitem">Services</a></li><li role="presentation"><a href="/case_studies.html" role="menuitem">Case Studies</a></li><li role="presentation"><a href="/portfolio.html" role="menuitem">Portfolio</a></li><li role="presentation"><a href="/contact_us.html" role="menuitem">Contact Us</a></li></ul></div><div id="pokematrix"><canvas id="pokematrixCanvas"></canvas><canvas id="pokematrixImage"></canvas><a id="pokematrixSign"><img src="/assets/go3d.svg" title="Enter the virtual 3D office" width="300" height="85" alt="A sign saying to go 3D"></a></div><img id="exit_image" alt="Exit sign" style="display:none;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHMAAABCCAYAAABkZenuAAAFc2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjExNSIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjY2IgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMTE1IgogICB0aWZmOkltYWdlTGVuZ3RoPSI2NiIKICAgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIKICAgdGlmZjpYUmVzb2x1dGlvbj0iNzIvMSIKICAgdGlmZjpZUmVzb2x1dGlvbj0iNzIvMSIKICAgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIKICAgcGhvdG9zaG9wOklDQ1Byb2Zp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"><img id="exit_image_mobile" alt="Exit sign" style="display:none;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHMAAABCCAYAAABkZenuAAAFemlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjExNSIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjY2IgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMTE1IgogICB0aWZmOkltYWdlTGVuZ3RoPSI2NiIKICAgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIKICAgdGlmZjpYUmVzb2x1dGlvbj0iNzIvMSIKICAgdGlmZjpZUmVzb2x1dGlvbj0iNzIvMSIKICAgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIKICAgcGhvdG9zaG9wOklDQ1Byb2Zp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"><div class="content_row" role="main"><script>window.addEventListener("DOMContentLoaded", function() {
  let images = document.querySelectorAll( '.blog_post img' );

  images.forEach( imageElm => {
    // Create a new anchor element
    const linkElm = document.createElement('a');
    // Set the href attribute to the image's src
    linkElm.href = imageElm.src;
    linkElm.classList.add('lightbox');
    
    // Insert the image as a child of the anchor element
    linkElm.appendChild(imageElm.cloneNode(true));
    
    // Replace the original image with the new anchor element
    imageElm.parentNode.replaceChild(linkElm, imageElm);
  } );
  const prvs = new Parvus();

});
</script><div class="content blog_post"><div class="breadcrumb"><a class="item" href="/blog.html">Blog</a><span class="item">&nbsp;&nbsp;>&nbsp;&nbsp;</span><span class="item">How to implement Blender Principled BSDF Materials in Three.jsÂ (WebGL)</span></div><h2>How to implement Blender Principled BSDF Materials in Three.jsÂ (WebGL)</h2><figure class="wp-block-image size-large"><img loading="lazy" decoding="async" width="1773" height="998" src="/assets/blog/2024/09/Screenshot-2024-09-21-042909-Large-edited.png" alt="" class="wp-image-152" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-21-042909-Large-edited.png 1773w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-21-042909-Large-edited-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-21-042909-Large-edited-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-21-042909-Large-edited-768x432.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-21-042909-Large-edited-1536x865.png 1536w" sizes="(max-width: 1773px) 100vw, 1773px"></figure>



<h3 class="wp-block-heading">Contents:</h3>



<ul class="wp-block-list">
<li><a href="#introduction">Introduction to Physically Based Rendering and Shaders</a></li>



<li><a href="#designing-materials">Designing physically based materials for the web</a></li>



<li><a href="#writing-aircraft-shaders">Writing a custom shader material for a sci-fi aircraft</a>
<ul class="wp-block-list">
<li><a href="#replacing-color-ramp-node">Replacing the Color Ramp node</a></li>



<li><a href="#replacing-voronoi-texture-node">Replacing the Voronoi texture node</a></li>



<li><a href="#debugging-custom-shaders">Debugging Custom Shaders</a></li>



<li><a href="#comparing-shaders">Comparing Blender shader material to final code</a></li>



<li><a href="#results-comparison">Side by side comparison</a></li>
</ul>
</li>



<li><a href="#writing-city-shaders">Writing a customer shader material for a futuristic sci-fi city</a>
<ul class="wp-block-list">
<li><a href="#recreating-brick-texture-node">Recreating the Brick Texture node</a></li>



<li><a href="#city-shader-result">Side by side comparison and final result</a></li>
</ul>
</li>



<li><a href="#programmatic-shader-transparency">Programmatically setting transparent areas in a shader surface</a>
<ul class="wp-block-list">
<li><a href="#developing-underwater-structures">Developing the custom structure using simple 3D geometry</a></li>



<li><a href="#underwater-structure-preview">The new structure</a></li>
</ul>
</li>



<li><a href="#creating-procedural-buildings">Creating new sci-fi structures with constructive solid geometry</a></li>



<li><a href="#creating-procedural-vehicles">Creating new sci-fi vehicles with constructive solid geometry</a></li>



<li><a href="#reusable-shader-fragments">Creating reusable shader fragments with Three.js</a></li>



<li><a href="#caching-shader-materials">Caching shader materials in the browser</a></li>



<li><a href="#summary">Summary</a></li>



<li><a href="#references">References and links</a></li>
</ul>



<h3 class="wp-block-heading" id="introduction">Introduction to Physically Based Rendering and Shaders</h3>



<p>Achieving realism in computer graphics requires a phenomenal amount of computing power. In order to reduce that workload, 3D graphics uses techniques like Physically Based Rendering (PBR), which simulates the realistic way that light interacts with surfaces. PBR relies on image-based data which can enhance a surface with additional detail using precalculated image-based representations of different properties. For example, the metallic map defines which areas of a texture are more reactive to light reflection.</p>



<p>Implementing PBR in real-time environments like web browsers presents additional challenges. Web technologies, such as WebGL, have more constraints compared to desktop software APIs like OpenGL. Compared to Three.js, Blender has more flexibility and more advanced rendering options that can be applied without concern for performance overhead. Shaders, the small programs that run on the GPU, can play a critical role in bridging this gap, allowing developers to create custom effects, lighting models, and procedural textures that can approximate a great level of detail without sacrificing performance.</p>



<p>In this article, Iâll walk through the process of creating physically based materials for a web game using Three.js and custom shaders, showcasing both the obstacles and breakthroughs involved in adapting complex materials originally designed in Blender to run efficiently in a browser environment.</p>



<p></p>



<h3 class="wp-block-heading" id="designing-materials">Designing physically based materials for the web</h3>



<p>As part of my recent sprint on the <em>Open Studios </em>project <em>Langenium</em>, I worked on a <a href="https://github.com/OpenStudiosCo/Langenium/issues/39">ticket</a> called âBasic Sceneryâ. While models have come and gone over the history of this project, the game has retained only one model for the playerâs avatar and one for background scenery, both developed for the original <em>Langenium </em>project back in 2012 so they were noticeably lacking in detail.</p>



<p>Originally I thought Iâd add some common materials to the game using free materials from online resources like <a href="https://freepbr.com/">FreePBR</a>, however for ease of use I opted to use free materials provided by the <a href="https://www.blenderkit.com/">BlenderKit</a> add-on. Unfortunately the models exported for use in the game engine had no textures despite the materials being ticked for export. After some Googling I learned that I had to âbakeâ the shader materials in order for them to be exported and loaded in other environments like Three.js.</p>


<div class="wp-block-image">
<figure class="aligncenter size-full is-resized"><img loading="lazy" decoding="async" width="2128" height="948" src="/assets/blog/2024/09/Screenshot-2024-06-19-220725.png" alt="" class="wp-image-43" style="width:840px;height:auto" srcset="https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725.png 2128w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725-300x134.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725-1024x456.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725-768x342.png 768w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725-1536x684.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725-2048x912.png 2048w" sizes="(max-width: 2128px) 100vw, 2128px"><figcaption class="wp-element-caption"><em>The Union Platform Model enhanced with a couple of free materials from the BlenderKit materials library. </em></figcaption></figure></div>


<p>Baking the materials fixed the issue and allowed shader material textures to export from Blender, but the file sizes had grown from 170KB to 30MB, which isnât acceptable for a web based game. Even if I could get away with one model, the cumulative effect of several models that size would mean people on mobile canât play. Worse yet â the textures, even with good compression, were blurry and no longer dynamically reacting to directional light, or showing animations. That file size is pretty standard in video games but it just wasnât acceptable given how much better everything looked in Blender where the materials were at a higher resolution and, most importantly, were animated and reacting to directional light.</p>


<div class="wp-block-image">
<figure class="aligncenter size-full"><img loading="lazy" decoding="async" width="2560" height="1392" src="/assets/blog/2024/09/image-2.png" alt="" class="wp-image-54" srcset="https://portal.openstudios.xyz/app/uploads/2024/08/image-2.png 2560w, https://portal.openstudios.xyz/app/uploads/2024/08/image-2-300x163.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/image-2-1024x557.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/image-2-768x418.png 768w, https://portal.openstudios.xyz/app/uploads/2024/08/image-2-1536x835.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/08/image-2-2048x1114.png 2048w" sizes="(max-width: 2560px) 100vw, 2560px"><figcaption class="wp-element-caption"><em>Editing the <a href="https://www.blenderkit.com/asset-gallery-detail/484c0cf9-6ae7-4bb1-801d-8bf40e70e554/">Procedural Abstract Sci-Fi Panels</a> material in Blender, used on the aircraft model.</em></figcaption></figure></div>


<p>Having a bit of practise implementing my own shader based materials in Blender and Three.js, I realised it was probably possible to recreate the BlenderKit materials within a <a href="https://threejs.org/docs/#api/en/materials/ShaderMaterial">THREE.ShaderMaterial</a>. My first attempt implemented <a href="https://nodetoy.co/">NodeToy</a>. I got something resembling the material pretty quickly however when I went to use it I got a lot of errors in my game. NodeToy uses itâs own format for shaders so I couldnât easily adapt what Iâd created without the NodeToy add-on.</p>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1233" height="925" src="/assets/blog/2024/09/Screenshot-2024-06-16-201726-edited-1.png" alt="" class="wp-image-82" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-16-201726-edited-1.png 1233w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-16-201726-edited-1-300x225.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-16-201726-edited-1-1024x768.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-16-201726-edited-1-768x576.png 768w" sizes="(max-width: 1233px) 100vw, 1233px"></figure>



<p>It was time to try a programmatic approach instead of relying on a 3rd partyâs custom format.</p>



<p></p>



<h3 class="wp-block-heading" id="writing-aircraft-shaders">Writing a custom shader material for a sci-fi aircraft</h3>



<p>Blender is open source but written in Python and the shader code is written within a larger shader material framework designed specifically for use in Blenderâs application framework. Programmatically speaking, it means I couldnât just lift the shader code I needed and stitch them back into my code â there were lots of smaller variables and settings that had to be setup in order to use their code for things like the Voronoi function. Licensing meant I may not have the rights to just take that bit of code from Blender for my project. There also wasnât a clear connection between some of the settings in the code and what was being used in the Blender application so I just had to write my own from scratch and build it up.</p>



<p>To implement my own custom shader, I created a new ShaderMaterial (js code below) and added some script tags to my document that would contain the shader code. I cloned one of the existing game shaders as a boilerplate, gutted it down to a simple colour draw  (html/glsl code below) and got to work populating it with logic that corresponded to each node, and link, in the Blender shader material.</p>



<p><strong>js</strong></p>



<pre class="wp-block-code language-js has-white-color has-black-background-color has-text-color has-background has-link-color wp-elements-f6bd2a6dd401357ddda4302277742c6b" data-language="js"><code class="language-js">  <span class="token keyword">let</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>ShaderMaterial</span><span class="token punctuation">(</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">vertexShader</span><span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token string">'proceduralBuildingVertShader'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">,</span>
    <span class="token literal-property property">fragmentShader</span><span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token string">'proceduralBuildingFragShader'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">,</span>
    <span class="token literal-property property">uniforms</span><span class="token operator">:</span> settings<span class="token punctuation">.</span>uniforms
  <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



<p><strong>html/glsl</strong></p>



<pre class="wp-block-code language-html has-white-color has-black-background-color has-text-color has-background has-link-color wp-elements-6d3e6dab6201cc4fd50b99fe4d416151" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>x-shader/x-vertex<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>proceduralBuildingVertShader<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>x-shader/x-vertex<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>proceduralBuildingFragShader<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></code></pre>



<p></p>



<h4 class="wp-block-heading" id="replacing-color-ramp-node">Replacing the Color Ramp node</h4>



<p>Recreating the <a href="https://docs.blender.org/manual/en/latest/editors/texture_node/types/converter/color_ramp.html">Colour Ramp node</a> was a matter of finding a GLSL gradient function I could adapt. Turning to Github I was fortunate to find an open source <a href="https://gist.github.com/tgfrerer/1640dd717e3ab1eada9f">Gist</a> containing a variety of gradient functions I could use. After the gradient functions were in place to mimic the Color Ramp node, the material began to match what I was seeing in Blender.</p>



<p>Searching Github can be very handy when you need to know how specific APIâs or functions are implemented by other coders. Especially when youâre working on something a bit niche and canât documentation in other places like forums, tutorial videos and dev blogs.</p>



<h4 class="wp-block-heading" id="replacing-voronoi-texture-node">Replacing the Voronoi texture node</h4>



<p>Voronoi textures are a popular tool for computer graphics, their cellular shapes can be made to resemble a number of artificial and natural structures. Within the material shaders Iâm using, the cells from Voronoi textures are used to define structure and metal panels covering the surface of the aircraft.</p>



<p>Iâve never been good at maths and certainly itâs a bit beyond my ability to just write my own Voronoi functions from scratch. Learning how to do all this is certainly possible, but there had to be some kind of useful resource out there that could give me a leg up rather than losing months of my life to that.</p>



<p>Mercifully <a href="https://github.com/kinakomoti-321/Voronoi_textures">someone had migrated the Voronoi function to native GLSL</a> which gave me a good starting point. Once I got my own Voronoi function setup, it wasnât too hard to complete the remainder of the shader materials to achieve an initial result on the playerâs aircraft. Only one layer of the material is present in the screenshot below, the white lines, but with just that you can already see details emerge.</p>



<p>The shape of the Voronoi cells in my output didnât quite match the original material â the BlenderKit material had metal panels made up of smaller shapes, while the most complex shapes I was initially creating were mostly whitespace with a few squares and triangles.</p>


<div class="wp-block-image">
<figure class="aligncenter size-full"><img loading="lazy" decoding="async" width="1686" height="685" src="/assets/blog/2024/09/Screenshot-2024-06-17-153223.png" alt="" class="wp-image-80" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-17-153223.png 1686w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-17-153223-300x122.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-17-153223-1024x416.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-17-153223-768x312.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-17-153223-1536x624.png 1536w" sizes="(max-width: 1686px) 100vw, 1686px"><figcaption class="wp-element-caption"><em>The first test of the new custom shader which combined the Voronoi texture with a black/white gradient</em>.</figcaption></figure></div>


<p>Debugging whatâs going on within shaders in Blender is a matter of reconnecting nodes to inspect their respective outputs. Doing so with code is pretty similar, I changed the <em>gl_FragColor </em>to be the <em>voronoi.rgb</em> value until I got the mapping correct so that the shapes matched. The exact forms are a little bit different; Iâm getting slightly more angular shapes instead of the cleaner cut straight angles of <a href="https://docs.blender.org/manual/en/latest/render/shader_nodes/textures/voronoi.html">Blenderâs Voronoi Texture node</a> but it was good enough for my purposes here.</p>



<div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-1 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1051" height="591" src="/assets/blog/2024/09/Screenshot-2024-06-18-233011-edited.png" alt="" class="wp-image-52" srcset="https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-233011-edited.png 1051w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-233011-edited-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-233011-edited-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-233011-edited-768x432.png 768w" sizes="(max-width: 1051px) 100vw, 1051px"></figure>
</div>



<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" width="1346" height="756" src="/assets/blog/2024/09/image-1-edited.png" alt="" class="wp-image-85" style="width:417px;height:auto" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/image-1-edited.png 1346w, https://portal.openstudios.xyz/app/uploads/2024/09/image-1-edited-300x168.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/image-1-edited-1024x575.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/image-1-edited-768x431.png 768w" sizes="(max-width: 1346px) 100vw, 1346px"></figure>
</div>
</div>



<p>I tried for a while to match the Voronoi Texture output variables in GLSL code to the same outputs in Blenderâs Voronoi Texture. This was important for recreating the same metal panelling shapes seen in the BlenderKit material. Blender was automatically normalising the RGB output to a grey colour, which I was able to recreate with a simple one liner provided by ChatGPT.</p>



<pre class="wp-block-code language-glsl has-white-color has-black-background-color has-text-color has-background has-link-color wp-elements-f06dd06019129b65fe12b9041b864d2b" data-language="glsl"><code class="language-glsl"><span class="token keyword">float</span> gray <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>voronoiValue<span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token number">0.2126</span><span class="token punctuation">,</span> <span class="token number">0.7152</span><span class="token punctuation">,</span> <span class="token number">0.0722</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gray <span class="token operator">=</span> <span class="token punctuation">(</span> gray <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.2</span><span class="token punctuation">;</span></code></pre>



<p></p>



<h4 class="wp-block-heading" id="debugging-custom-shaders">Debugging Custom Shaders</h4>



<p>Writing custom shaders can be a challenging process, especially when things donât work as expected. Shaders run within the GPU hardware making them notoriously difficult to debug since thereâs no straightforward way to log variables or print errors like you would in traditional programming languages. Instead, you rely heavily on visual feedback and careful analysis of your code. Here are some things to keep in mind when debugging your own custom shaders.</p>



<ol class="wp-block-list">
<li><strong>Visualizing Outputs</strong>
<ul class="wp-block-list">
<li>One of the simplest yet most effective ways to debug shaders is visualizing calculated outputs directly in your scene. For instance, if youâre trying to understand whatâs happening with a particular texture, uniform, or math operation, you can assign the value youâre working on directly to <em>gl_FragColor </em>in the fragment shader.</li>



<li>Many shader effects rely on the mathematical operations between variables that are themselves calculated elsewhere, so visualising what these individual components are doing can help move things along better than just trying endless variations of your original code.</li>
</ul>
</li>



<li><strong>Simplifying the Shader</strong>
<ul class="wp-block-list">
<li>When complex shaders crash your application or fail to compile, it helps to break the problem down by simplifying your shader code. Start by reducing it to a basic state (e.g., simple colour rendering) and then gradually reintroduce features like textures, lighting, and animation effects. This incremental approach lets you isolate the issue and ensures that you always have a working base to return to.</li>



<li>For example, when having issues with using my Voronoi texture as a mask, I gutted the original shader and started with a simple colour draw before adding each feature one at a time. This method made it easier to identify where things were going wrong as I reintroduced individual components.</li>



<li>This kind of step-by-step approach also keeps the shader manageable, allowing you to optimize as you go. Comprehending how a shader works can be confusing due to their per pixel nature, i.e. the entire Fragment shader runs for each pixel for each frame.</li>
</ul>
</li>



<li><strong>Setup for visual inspection</strong>
<ul class="wp-block-list">
<li>As part of this ticket, I extended the game engine with a debugging mode. When activated a scene outline appears along with performance stats and editor tools like <a href="https://threejs.org/docs/#examples/en/controls/OrbitControls">orbit controls</a>.</li>



<li>I used the debugging mode to switch the game from player controls to the orbit controls and targeted the object in question which allowed me to easily inspect it from multiple angles and distances.</li>



<li>For testing out geometry / vertex displacement, it was handy to switch into wireframe mode to see the exact effect that changes were having on objects.</li>
</ul>
</li>



<li><strong>WebGL Limits</strong>
<ul class="wp-block-list">
<li>Finally, remember that 3D on the web has certain limitations compared to desktop-based graphics applications like Blender. You may encounter limitations with precision, texture formats, and how geometry is handled. For example, WebGL shaders might not support some complex procedural textures or displacement effects that work in Blender. Instead, you can use alternatives such as pre-calculated textures or vertex shaders to handle some of the geometry calculations.</li>
</ul>
</li>
</ol>



<p></p>



<h4 class="wp-block-heading" id="comparing-shaders">Comparing Blender shader material to final code</h4>



<p>This annotated screenshot shows the original material in Blender and how it relates to the new Procedural Metal fragment shader. Hereâs whatâs going on:</p>



<ul class="wp-block-list">
<li><strong>Red</strong>: Voronoi Texture generation, creates the metal panelling shapes</li>



<li><strong>Blue</strong>: Creates the first gradient filter which draws white lines on the aircraft surface</li>



<li><strong>Green</strong>: Creates the second gradient filter which draws red lines on the aircraft surface</li>



<li><strong>Yellow</strong>: Merges all the outputs into a single colour using PBR techniques</li>



<li><strong>Magenta</strong>: Creates a displacement map that simulates ridges between metal panels</li>



<li><strong>Cyan</strong>: Sends the output to the shader for display</li>
</ul>


<div class="wp-block-image">
<figure class="aligncenter size-full is-resized"><img loading="lazy" decoding="async" width="3840" height="2160" src="/assets/blog/2024/09/2024-09-18-Shader-Translation.png" alt="" class="wp-image-83" style="width:840px;height:auto" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation.png 3840w, https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation-768x432.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation-1536x864.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation-2048x1152.png 2048w" sizes="(max-width: 3840px) 100vw, 3840px"></figure></div>


<p></p>



<h4 class="wp-block-heading" id="results-comparison">Side by side comparison</h4>



<p>The Procedural Metal material isnât an exact match to the original one from BlenderKit, however itâs more than enough for this stage of the project. </p>



<div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-2 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" width="960" height="540" src="/assets/blog/2024/09/image-3.png" alt="" class="wp-image-55" style="width:428px;height:auto" srcset="https://portal.openstudios.xyz/app/uploads/2024/08/image-3.png 960w, https://portal.openstudios.xyz/app/uploads/2024/08/image-3-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/image-3-768x432.png 768w" sizes="(max-width: 960px) 100vw, 960px"></figure>
</div>



<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" width="1457" height="895" src="/assets/blog/2024/09/Screenshot-2024-06-18-173514.png" alt="" class="wp-image-39" style="width:393px;height:auto" srcset="https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-173514.png 1457w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-173514-300x184.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-173514-1024x629.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-173514-768x472.png 768w" sizes="(max-width: 1457px) 100vw, 1457px"></figure>
</div>
</div>



<p>The full source code for the new aircraft material, known in Langeniumâs codebase as the Procedural Metal shader, is open source and available on Github via the links below.</p>



<ul class="wp-block-list">
<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralMetal.vert">Procedural Metal Vertex shader</a></li>



<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralMetal.frag">Procedural Metal Fragment shader</a></li>
</ul>



<p></p>



<h3 class="wp-block-heading" id="writing-city-shaders">Writing a customer shader material for a futuristic sci-fi city</h3>



<p>Now that the main player aircraft was starting to look like it does in Blender, it was time to work on the gameâs futuristic city. This model uses three different procedural materials â <a href="https://www.blenderkit.com/asset-gallery-detail/9430fd1f-a2cd-4df6-ae1d-0ba2ad84b5de/">Procedural Scifi Greeble</a> for the cityâs chassis and megastructure, a modified <a href="https://www.blenderkit.com/asset-gallery-detail/c23680d6-fde9-441c-bab2-99922f4686bc/">Procedural Scifi Alien Metal Green</a> for the buildings and <a href="https://www.blenderkit.com/asset-gallery-detail/e92512fb-12b5-4142-878a-c12a5c9f70a0/">Solar Panel</a> material for the six enormous ones protruding from the city.</p>



<p>All the materials used by the city called for the Colour Ramp node, the buildings and chassis also required the Voronoi Texture node and a Brick Texture node. It was time to write my own Brick Texture function.</p>



<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" width="1719" height="1312" src="/assets/blog/2024/09/Screenshot-2024-06-22-193702.png" alt="" class="wp-image-46" style="width:840px;height:auto" srcset="https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193702.png 1719w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193702-300x229.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193702-1024x782.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193702-768x586.png 768w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193702-1536x1172.png 1536w" sizes="(max-width: 1719px) 100vw, 1719px"></figure>



<p></p>



<h4 class="wp-block-heading" id="recreating-brick-texture-node">Recreating the Brick Texture node</h4>



<p>The <a href="https://docs.blender.org/manual/en/latest/render/shader_nodes/textures/brick.html">Brick Texture</a> node provides the square shape for metal panelling in the Procedural Scifi Greeble material used by the cityâs megastructure/cradle/chassis. This texture node draws a brick like grid with optionally offset rows and other settings for things like gutter widths. As it was pretty easy to conceptualize, I got ChatGPT to help me recreate the Brick Texture in GLSL. The current result isnât an exact recreation of what was in Blender but once again itâs close enough.</p>



<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" width="1388" height="886" src="/assets/blog/2024/09/Screenshot-2024-06-19-220826.png" alt="" class="wp-image-45" style="width:840px;height:auto" srcset="https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220826.png 1388w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220826-300x191.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220826-1024x654.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220826-768x490.png 768w" sizes="(max-width: 1388px) 100vw, 1388px"></figure>



<p></p>



<h4 class="wp-block-heading" id="city-shader-result">Side by side comparison and final result</h4>



<p>There were two major differences between the Blender version and the final result I got. I wasnât able to get the same shapes on the cityâs buildings, potentially because I am using WebGL compatible Voronoi and Brick texture code that differ too much from Blender. The other difference is the displacement map doesnât affect vertices as nicely in the game as it does in Blender. This is something I might be able to work on but I currently donât really want to delve too deep into getting that right now due to the functions I needed to draw the textures not being available in the vertex shader. I found this out when I tried to migrate the Voronoi and Brick texture code into the vertex shader but just couldnât get it to work.</p>



<p>The problem is that in WebGL / real time graphics there is a more rigid rendering order and pipeline than Blender. As a 3D graphics design tool, Blender can implement a material shader node that modifies geometry because itâs not trying to maintain 60 FPS (Frames Per Second). It might be possible to implement some additional logic to make Three.js support this, perhaps even just by modifying the actual texture codeâ¦ but thatâs just a rabbit hole I donât want to deal with right now.</p>



<div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-3 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1019" height="573" src="/assets/blog/2024/09/Screenshot-2024-06-22-060854-edited.png" alt="" class="wp-image-86" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-060854-edited.png 1019w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-060854-edited-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-060854-edited-768x432.png 768w" sizes="(max-width: 1019px) 100vw, 1019px"></figure>
</div>



<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1119" height="630" src="/assets/blog/2024/09/Screenshot-2024-06-22-193442-edited-1.png" alt="" class="wp-image-88" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-193442-edited-1.png 1119w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-193442-edited-1-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-193442-edited-1-1024x577.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-193442-edited-1-768x432.png 768w" sizes="(max-width: 1119px) 100vw, 1119px"></figure>
</div>
</div>



<p>Overall Iâm happy with how the city ended up looking, the entire model reacts nicely to the environments lighting model and has set the aesthetic for structures in the environment.</p>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1390" height="887" src="/assets/blog/2024/09/Screenshot-2024-06-22-193544.png" alt="" class="wp-image-40" srcset="https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193544.png 1390w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193544-300x191.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193544-1024x653.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193544-768x490.png 768w" sizes="(max-width: 1390px) 100vw, 1390px"></figure>



<p>The full source code for the procedural city materials are open source and available on Github via the links below.</p>



<ul class="wp-block-list">
<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralSolarPanel.vert">Solar Panel Vertex shader</a></li>



<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralSolarPanel.frag">Solar Panel Fragment shader</a></li>



<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralBuilding.vert">City Building Vertex shader</a></li>



<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralBuilding.frag">City Building Fragment shader</a></li>



<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralMetal2.vert">City Chassis Vertex shader</a></li>



<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralMetal2.frag">City Chassis Fragment shader</a></li>
</ul>



<p></p>



<h3 class="wp-block-heading" id="programmatic-shader-transparency">Programmatically setting transparent areas in a shader surface</h3>



<p>Iâd thought about what kind of interesting objects I could place on the oceanâs surface that made sense with the game lore, and came up with the idea of these giant industrial wells with an opening you can see from above that reaches below the water level. Now that I had a bit of practise with writing shader code, I decided to tackle cutting shapes out of the ocean. Iâm using the <a href="https://threejs.org/examples/webgl_water.html">THREE.Water</a> for the oceanâs surface and opted to just hack the inline GLSL used by that for now. I passed in a custom alpha map texture which would be used to determine whether to draw water or show transparency. To ensure the concept would work, I initially used a simple solid white PNG with a couple of solid black hearts.</p>



<div class="wp-block-columns is-layout-flex wp-container-core-columns-is-layout-4 wp-block-columns-is-layout-flex">
<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1984" height="1116" src="/assets/blog/2024/09/test2-edited-1.png" alt="" class="wp-image-93" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/test2-edited-1.png 1984w, https://portal.openstudios.xyz/app/uploads/2024/09/test2-edited-1-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/test2-edited-1-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/test2-edited-1-768x432.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/test2-edited-1-1536x864.png 1536w" sizes="(max-width: 1984px) 100vw, 1984px"></figure>
</div>



<div class="wp-block-column is-layout-flow wp-block-column-is-layout-flow">
<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1379" height="776" src="/assets/blog/2024/09/Screenshot-2024-06-24-021844-edited-1.png" alt="" class="wp-image-94" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-021844-edited-1.png 1379w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-021844-edited-1-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-021844-edited-1-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-021844-edited-1-768x432.png 768w" sizes="(max-width: 1379px) 100vw, 1379px"></figure>
</div>
</div>



<p>With the concept proven, I changed the shader uniforms to take in an array of co-ordinates of where the industrial wells would be. Within the shader, the co-ordinates were iterated and a hexagon was placed at each location and used as an alpha map to create the transparency in the ocean.</p>



<p>Here are what those additions are in <a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/app/scenograph/materials/water.js" data-type="link" data-id="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/app/scenograph/materials/water.js">my copy of THREE.Water</a>:</p>



<pre class="wp-block-code language-glsl has-white-color has-black-background-color has-text-color has-background has-link-color wp-elements-852fd2a80e5a3156320504b7155c5a7d" data-language="glsl"><code class="language-glsl"><span class="token comment">// added to the uniforms section at the start of the shader</span>
<span class="token keyword">uniform</span> <span class="token keyword">float</span> submerged_objects<span class="token punctuation">[</span>$<span class="token punctuation">{</span>submergedObjectsFlattened<span class="token punctuation">.</span>length<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">uniform</span> <span class="token keyword">int</span> submerged_objects_length<span class="token punctuation">;</span>

<span class="token comment">// added before the final gl_Fragcolor assignment in the main function</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> submerged_objects_length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> x <span class="token operator">=</span> submerged_objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> y <span class="token operator">=</span> submerged_objects<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> radius <span class="token operator">=</span> submerged_objects<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// Calculate the absolute distance from the center (x, y)</span>
    <span class="token keyword">vec2</span> delta <span class="token operator">=</span> <span class="token function">abs</span><span class="token punctuation">(</span>worldPosition<span class="token punctuation">.</span>xz <span class="token operator">-</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Calculate the half-width of the octagon sides</span>
    <span class="token keyword">float</span> halfSideLength <span class="token operator">=</span> radius <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Check if the point is within the octagon shape</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
        delta<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> halfSideLength <span class="token operator">&amp;&amp;</span>
        delta<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> halfSideLength <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span>delta<span class="token punctuation">.</span>x <span class="token operator">+</span> delta<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> radius
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">discard</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>



<p>If youâre unfamiliar with GLSL, the <code>discard</code> command tells the Fragment shader not to draw this fragment. This ended up being even cleaner than setting it to transparent.</p>



<p>With the hole cut out, it was a trivial effort to chuck a hexagonal cylinder into the hole and use the city building material on it.</p>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1394" height="897" src="/assets/blog/2024/09/Screenshot-2024-06-24-031522.png" alt="" class="wp-image-62" srcset="https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-24-031522.png 1394w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-24-031522-300x193.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-24-031522-1024x659.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-24-031522-768x494.png 768w" sizes="(max-width: 1394px) 100vw, 1394px"></figure>



<p></p>



<h4 class="wp-block-heading" id="developing-underwater-structures">Developing the custom structure using simple 3D geometry</h4>



<p>The walls of the new structure looked a little thin and I wanted it to look convincing. The water line also clipped into the walls a little bit which wasnât ideal, itâd occasionally glitch as you rotated the camera.</p>



<p>Langenium uses a library called <a href="https://github.com/gkjohnson/three-bvh-csg">three-bvh-csg</a> for Constructive Solid Geometry (CSG) features. These features can be used to do simple math operations on 3D Objects. I used CSG subtraction to subtract a smaller cylinder from the main structure, creating a thick wall which worked well to achieve the result I was after. The edges of the water are nicely covered and the structure looked complete.</p>



<p>Looking to fill out the empty space a bit, I tried to add some storage tanks and dome shaped buildings but it just looked busy. I also had some fun with it and drew a face with the buildings.</p>



<figure class="wp-block-gallery has-nested-images columns-default is-cropped wp-block-gallery-1 is-layout-flex wp-block-gallery-is-layout-flex">
<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1092" height="671" data-id="97" src="/assets/blog/2024/09/Screenshot-2024-06-24-071541.png" alt="" class="wp-image-97" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-071541.png 1092w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-071541-300x184.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-071541-1024x629.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-071541-768x472.png 768w" sizes="(max-width: 1092px) 100vw, 1092px"></figure>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1012" height="714" data-id="98" src="/assets/blog/2024/09/Screenshot-2024-06-24-074247.png" alt="" class="wp-image-98" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-074247.png 1012w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-074247-300x212.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-074247-768x542.png 768w" sizes="(max-width: 1012px) 100vw, 1012px"></figure>
</figure>



<p>In the end the structures didnât add enough to justify their existence so I opted to just make the wells really deep so the effect would be dramatic if you fly over them in your aircraft.</p>



<figure class="wp-block-image size-full is-resized"><img loading="lazy" decoding="async" width="595" height="335" src="/assets/blog/2024/09/Screenshot-2024-08-25-041411-edited.png" alt="" class="wp-image-134" style="width:840px;height:auto" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-08-25-041411-edited.png 595w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-08-25-041411-edited-300x169.png 300w" sizes="(max-width: 595px) 100vw, 595px"></figure>



<p></p>



<h4 class="wp-block-heading" id="underwater-structure-preview">The new structure</h4>



<p>Playing around with alpha mapping, I was able to quickly creating a unique new asset for the game now called an Extractor. A key part of some gameplay ideas in the works, but more on that later.</p>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1242" height="705" src="/assets/blog/2024/09/image-6.png" alt="" class="wp-image-66" srcset="https://portal.openstudios.xyz/app/uploads/2024/08/image-6.png 1242w, https://portal.openstudios.xyz/app/uploads/2024/08/image-6-300x170.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/image-6-1024x581.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/image-6-768x436.png 768w" sizes="(max-width: 1242px) 100vw, 1242px"></figure>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1835" height="862" src="/assets/blog/2024/09/Screenshot-2024-08-25-041352.png" alt="" class="wp-image-63" srcset="https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-08-25-041352.png 1835w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-08-25-041352-300x141.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-08-25-041352-1024x481.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-08-25-041352-768x361.png 768w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-08-25-041352-1536x722.png 1536w" sizes="(max-width: 1835px) 100vw, 1835px"></figure>



<p></p>



<h3 class="wp-block-heading" id="creating-procedural-buildings">Creating new sci-fi structures with constructive solid geometry</h3>



<p>Encouraged by the leaps and bounds the game environment had been enhanced by this work, I decided to add another object to the environment. Given the last one was an industrial âExtractorâ I decide to name this next structure the Refinery. Using a tetrahedron as a base, I stretched, rotated it so one corner would face up and submerged it partly â to look like a futuristic pyramid floating on the water.</p>



<p>To add complexity to the basic shape, I added a smaller inner tetrahedron with a different darker material and then used Constructive Solid Geometry to cut horizontal slices out of the outer shape. The outer object uses the city chassis material and the inner shape uses the city building materials.</p>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1427" height="802" src="/assets/blog/2024/09/Screenshot-2024-06-28-035238-edited.png" alt="" class="wp-image-135" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-035238-edited.png 1427w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-035238-edited-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-035238-edited-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-035238-edited-768x432.png 768w" sizes="(max-width: 1427px) 100vw, 1427px"></figure>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1366" height="681" src="/assets/blog/2024/09/Screenshot-2024-06-28-162051-Medium.png" alt="" class="wp-image-136" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-162051-Medium.png 1366w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-162051-Medium-300x150.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-162051-Medium-1024x511.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-162051-Medium-768x383.png 768w" sizes="(max-width: 1366px) 100vw, 1366px"></figure>



<figure class="wp-block-image size-full is-resized"><img decoding="async" src="/assets/blog/2024/09/Screenshot-2024-06-28-044923-edited.png" alt="" class="wp-image-95" style="width:840px;height:auto"></figure>



<p></p>



<h3 class="wp-block-heading" id="creating-procedural-vehicles">Creating new sci-fi vehicles with constructive solid geometry</h3>



<p>Having the City, Refinery and Extractor structures in place I was inspired to add some transport ships that would travel in between them. Once again, using the new procedural shader materials and Constructive Solid Geometry, I created some chevron shapes. This result is quite simple but perfect as a background object that the player wonât really be too focused on up close.</p>



<p>In the future, it would be good to add some additional geometry to these such as crew compartments and communication equipment you usually see on ships. For now, the result is good enough.</p>



<figure class="wp-block-image size-large"><img loading="lazy" decoding="async" width="1024" height="665" src="/assets/blog/2024/09/Screenshot-2024-09-19-000932-Large-1024x665.png" alt="" class="wp-image-101" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000932-Large-1024x665.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000932-Large-300x195.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000932-Large-768x498.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000932-Large-1536x997.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000932-Large.png 1664w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>



<figure class="wp-block-gallery has-nested-images columns-default is-cropped wp-block-gallery-2 is-layout-flex wp-block-gallery-is-layout-flex">
<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1920" height="995" data-id="100" src="/assets/blog/2024/09/Screenshot-2024-09-19-001007-Large.png" alt="" class="wp-image-100" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-001007-Large.png 1920w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-001007-Large-300x155.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-001007-Large-1024x531.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-001007-Large-768x398.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-001007-Large-1536x796.png 1536w" sizes="(max-width: 1920px) 100vw, 1920px"></figure>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="1366" height="708" data-id="102" src="/assets/blog/2024/09/Screenshot-2024-09-19-000946-Large-Medium.png" alt="" class="wp-image-102" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000946-Large-Medium.png 1366w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000946-Large-Medium-300x155.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000946-Large-Medium-1024x531.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000946-Large-Medium-768x398.png 768w" sizes="(max-width: 1366px) 100vw, 1366px"></figure>
</figure>



<p></p>



<h3 class="wp-block-heading" id="reusable-shaders-fragments">Creating reusable shader fragments with Three.js</h3>



<p>As this ticket progressed, I tried to figure out an optimal way to structure all the fragment shader code. I needed them to share common functions and clearly define what theyâre doing in a main outline. Three.js doesnât support GLSL includes but provides a mechanism called <a href="https://threejs.org/docs/#api/en/renderers/shaders/ShaderChunk">ShaderChunk</a> that allows you to do essentially the same thing at runtime.</p>



<p>Rather than including a file with a call like <code>#include voronoi.glsl</code>, the Three.js ShaderChunk uses variables and so I just had to use <code>#include &lt;voronoi&gt;</code> and declare the shader chunk variable. The Langenium engine implements a Materials class that does the following in its constructor to declare the shader chunk variables for compilation.</p>



<pre class="wp-block-code language-glsl has-white-color has-black-background-color has-text-color has-background has-link-color wp-elements-c00066894ecc16f26fcabea0e50ebbf6" data-language="glsl"><code class="language-glsl">    <span class="token comment">// Initialise custom shader chunks.</span>
    <span class="token keyword">const</span> brickGLSL <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token char">'brickGLSL'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>
    <span class="token keyword">const</span> gradientGLSL <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token char">'gradientGLSL'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>
    <span class="token keyword">const</span> normalGLSL <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token char">'normalGLSL'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>
    <span class="token keyword">const</span> voronoiGLSL <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token char">'voronoiGLSL'</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>

    THREE<span class="token punctuation">.</span>ShaderChunk<span class="token punctuation">[</span> <span class="token char">'brick'</span> <span class="token punctuation">]</span> <span class="token operator">=</span> brickGLSL<span class="token punctuation">;</span>
    THREE<span class="token punctuation">.</span>ShaderChunk<span class="token punctuation">[</span> <span class="token char">'gradient'</span> <span class="token punctuation">]</span> <span class="token operator">=</span> gradientGLSL<span class="token punctuation">;</span>
    THREE<span class="token punctuation">.</span>ShaderChunk<span class="token punctuation">[</span> <span class="token char">'normal'</span> <span class="token punctuation">]</span> <span class="token operator">=</span> normalGLSL<span class="token punctuation">;</span>
    THREE<span class="token punctuation">.</span>ShaderChunk<span class="token punctuation">[</span> <span class="token char">'voronoi'</span> <span class="token punctuation">]</span> <span class="token operator">=</span> voronoiGLSL<span class="token punctuation">;</span></code></pre>



<p>In the screenshot below you can see the Procedural Metal Fragment shader along with the ShaderChunk variable includes itâs using â gradient, normal and voronoi.</p>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="3840" height="2112" src="/assets/blog/2024/09/image.png" alt="" class="wp-image-103" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/image.png 3840w, https://portal.openstudios.xyz/app/uploads/2024/09/image-300x165.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/image-1024x563.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/image-768x422.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/image-1536x845.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/09/image-2048x1126.png 2048w" sizes="(max-width: 3840px) 100vw, 3840px"></figure>



<p>The full source code for the common shader files and material class are open source and available on Github via the links below.</p>



<ul class="wp-block-list">
<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/app/scenograph/materials.js">Materials class</a>
<ul class="wp-block-list">
<li>A common global used to declare materials in the Langenium engine</li>
</ul>
</li>



<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/common/brick.glsl">Brick</a>
<ul class="wp-block-list">
<li>Provides functions that take inputs to create a brick pattern texture</li>
</ul>
</li>



<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/common/gradient.glsl">Gradient</a>
<ul class="wp-block-list">
<li>Provides functions that take two or more colour inputs and creates a gradient</li>
</ul>
</li>



<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/common/normal.glsl">Normal</a>
<ul class="wp-block-list">
<li>Provides functions that simulate displacement mapping and handle light direction</li>
</ul>
</li>



<li><a href="https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/common/voronoi.glsl">Voronoi</a>
<ul class="wp-block-list">
<li>Provides functions that take inputs to create cellular Voronoi graphs</li>
</ul>
</li>
</ul>



<p></p>



<h3 class="wp-block-heading" id="caching-shader-materials">Caching shader materials in the browser</h3>



<p>Looking to optimize the new materials, I had the idea to cache key data such as the noise maps, normal maps and Voronoi textures. Even if I couldnât fit them into memory, modern technologies like the Web Storage API which could come in handy for caching procedurally generated files automatically optimised for and stored on a userâs device.</p>



<p>To cache procedurally generated shader materials, I needed to render the texture images in a separate pass from the main loop. In my proof of concept, I applied the Procedural Metal shader to a flat mesh using PlaneGeometry and rendered the result onto a canvas element. To preview the cached texture separately from the 3D model, I displayed the canvas as an overlay.</p>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="2554" height="1271" src="/assets/blog/2024/09/Screenshot-2024-06-20-230627.png" alt="" class="wp-image-124" srcset="https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627.png 2554w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627-300x149.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627-1024x510.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627-768x382.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627-1536x764.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627-2048x1019.png 2048w" sizes="(max-width: 2554px) 100vw, 2554px"></figure>



<p>This approach was good enough to cover the mesh with texture sort of close but unfortunately the use of a PlaneGeometry meant it didnât look the same in practise as a shader material that wrapped itself around the custom geometry of the aircraft model. When I tried to fix this issue, I discovered it wasnât possible to export the custom surface details along with how they map to a custom model.</p>



<p>In the future I definitely want to revisit this technique and try to complete the approach by caching the material mapping data. Even if that doesnât work out, this approach could come in handy as an optimisation for objects that are too far away to see details on. When dozens of aircraft are in the scene, this could be an essential part of the strategy to optimising engine performance.</p>



<p></p>



<h3 class="wp-block-heading" id="summary">Summary</h3>



<p>The new materials and objects have created a solid foundation that can be enhanced and extended in the future. In particular I would love to get geometry displacement and caching right. Achieving a displacement effect similar to Blenderâs shader node may still be possible in the browser but it will probably be a significant challenge. Caching shader materials would allow advanced visuals and effects to be accessible on older and lower powered devices, as well as allowing for more overhead for even more advanced visuals on more powerful hardware.</p>



<p>All the new assets produced in this piece of work have setup the game environment for actual gameplay features to now be added. Previous versions of Langenium had a Bullet Hell style approach, but in practise it was actually not very fun trying to line up shots in a straight line. That kind of play style might have been acceptable twenty or thirty years ago but not today. Especially on a mobile where you donât have very good controls for fast reaction times to dodge attacks.</p>



<p>Langenium is my love letter to my favourite video games and the game development scene at large, it includes gameplay ideas that mix real time strategy, role playing games (RPG) and aircraft simulators. With the new visuals, I believe the project has become elevated to a new height â the game is visually comparable to modern console and PC games that occupy tens to hundreds of gigabytes of storage.</p>



<p>The next ticket is called Basic Gameplay and will introduce more UI development, pathfinding AI, enemy aircraft models, targeting overlays, missiles and damage systems. The final goal of this ticket is to have players control a protector aircraft for the cargo ships which will be under attack by hostile aircraft. Within the gameâs story, cargo ships are transporting the titular Langenium element between extractors, refineries and the main city.</p>



<p></p>



<h3 class="wp-block-heading" id="references">References and links</h3>



<ul class="wp-block-list">
<li>Langenium Pull Request #42 
<ul class="wp-block-list">
<li><a href="https://github.com/OpenStudiosCo/Langenium/pull/42">https://github.com/OpenStudiosCo/Langenium/pull/42</a></li>
</ul>
</li>



<li>Langenium Issue #39
<ul class="wp-block-list">
<li><a href="https://github.com/OpenStudiosCo/Langenium/issues/39">https://github.com/OpenStudiosCo/Langenium/issues/39</a></li>
</ul>
</li>



<li>ShaderMaterial on Three.js Official Docs
<ul class="wp-block-list">
<li><a href="https://threejs.org/docs/#api/en/materials/ShaderMaterial">https://threejs.org/docs/#api/en/materials/ShaderMaterial</a></li>
</ul>
</li>



<li>Voronoi GLSL texture functions
<ul class="wp-block-list">
<li><a href="https://github.com/kinakomoti-321/Voronoi_textures">https://github.com/kinakomoti-321/Voronoi_textures</a></li>
</ul>
</li>



<li>Blender Texture Material GLSL source code
<ul class="wp-block-list">
<li><a href="https://github.com/blender/blender/blob/main/source/blender/gpu/shaders/material/gpu_shader_material_tex_noise.glsl">https://github.com/blender/blender/blob/main/source/blender/gpu/shaders/material/gpu_shader_material_tex_noise.glsl</a></li>
</ul>
</li>



<li>Voronoise article, explaining how to create voronoi textures with snoise
<ul class="wp-block-list">
<li><a href="https://iquilezles.org/articles/voronoise">https://iquilezles.org/articles/voronoise</a></li>
</ul>
</li>



<li>Gradient GLSL Gist, used in the Langenium game engine
<ul class="wp-block-list">
<li><a href="https://gist.github.com/tgfrerer/1640dd717e3ab1eada9f">https://gist.github.com/tgfrerer/1640dd717e3ab1eada9f</a></li>
</ul>
</li>



<li>BlenderKit materials used
<ul class="wp-block-list">
<li>Procedural Scifi Alien Metal Green, <a href="https://www.blenderkit.com/asset-gallery-detail/c23680d6-fde9-441c-bab2-99922f4686bc/">https://www.blenderkit.com/asset-gallery-detail/c23680d6-fde9-441c-bab2-99922f4686bc/</a></li>



<li>Procedural Abstract Sci-Fi Panels, <a href="https://www.blenderkit.com/asset-gallery-detail/484c0cf9-6ae7-4bb1-801d-8bf40e70e554/">https://www.blenderkit.com/asset-gallery-detail/484c0cf9-6ae7-4bb1-801d-8bf40e70e554/</a></li>



<li>Procedural Scifi Greeble, <a href="https://www.blenderkit.com/asset-gallery-detail/9430fd1f-a2cd-4df6-ae1d-0ba2ad84b5de/">https://www.blenderkit.com/asset-gallery-detail/9430fd1f-a2cd-4df6-ae1d-0ba2ad84b5de/</a></li>



<li>Solar Panel, <a href="https://www.blenderkit.com/asset-gallery-detail/e92512fb-12b5-4142-878a-c12a5c9f70a0/">https://www.blenderkit.com/asset-gallery-detail/e92512fb-12b5-4142-878a-c12a5c9f70a0/</a></li>
</ul>
</li>
</ul>



<p></p>
<br><br><a href="/blog.html">Back to Blog Home</a></div></div><div class="content_row newsletter" role="complementary"><div class="newsletter_bg"></div><div class="content"><div class="row center"><div class="wide-column"><script>function newsletterSubmit(token) {
    var validationElm = document.getElementById("newslettervalidation");
    var data = document.getElementById("newsletterform");
    fetch(data.getAttribute('action'), {
        method: data.getAttribute('method'),
        body: new FormData(data)
    }).then(function (response) {
        if (response.status === 200) {
        return response.text();
        } else {
        validationElm.innerHTML = response.text();
        }
    })
    .then(function (data) {
        validationElm.innerHTML = data;
        if (validationElm.innerHTML.indexOf('Email sent successfully.') >= 0) {
            document.getElementById("newsletterform").reset();
        }
    });
}</script><form id="newsletterform" method="post" action="https://mailform.openstudios.xyz/" role="form"><h3>Subscribe to our newsletter</h3><p>Get all our latest insights, tips and project updates, conveniently in your inbox.</p><table style="width: 100%"><tr><td style="width: 80%"><input type="hidden" name="name" value="n/a"><input type="hidden" name="message" value="Newsletter signup request"><input type="email" name="email" placeholder="Email address"></td><td style="padding-left: 1rem"><button class="g-recaptcha" data-sitekey="6LeiXp4nAAAAAKRxcYacR0ZhbcNjf7OMCkjolpNL" data-callback="newsletterSubmit" data-action="submit">Subscribe</button></td></tr></table><h3 id="newslettervalidation" style="color: red; font-weight: bold;"></h3></form></div></div></div></div><div class="content_row footer"><div class="content"><div class="row"><div class="narrow-column"><h3>About us</h3><ul role="menu"><li role="presentation"><a href="/about_us.html" role="menuitem">Meet the team</a></li><li role="presentation"><a href="/about_us.html" role="menuitem">Tools of the trade</a></li><li role="presentation"><a href="/about_us.html" role="menuitem">Our values</a></li><li role="presentation"><a href="/blog.html" role="menuitem">Blog</a></li></ul></div><div class="narrow-column"><h3>Services</h3><ul role="menu"><li role="presentation"><a href="/services.html" role="menuitem">3D Modelling and Printing</a></li><li role="presentation"><a href="/services.html" role="menuitem">Animation</a></li><li role="presentation"><a href="/services.html" role="menuitem">Game Development</a></li><li role="presentation"><a href="/services.html" role="menuitem">Graphic Design</a></li><li role="presentation"><a href="/services.html" role="menuitem">Interactive Design</a></li><li role="presentation"><a href="/services.html" role="menuitem">Marketing Design</a></li><li role="presentation"><a href="/services.html" role="menuitem">Product design</a></li><li role="presentation"><a href="/services.html" role="menuitem">Web design</a></li><li role="presentation"><a href="/services.html" role="menuitem">Web development</a></li><li role="presentation"><a href="/services.html" role="menuitem">Video production</a></li></ul></div><div class="narrow-column"><h3>Our work</h3><ul role="menu"><li role="presentation"><a href="/case_studies.html" role="menuitem">Case studies</a></li><li role="presentation"><a href="/portfolio.html" role="menuitem">Portfolio</a></li><li role="presentation"><a href="/contact_us.html" role="menuitem">Contact Us</a></li></ul></div><div class="narrow-column"><h3>Terms</h3><ul role="menu"><li role="presentation"><a href="/accessibility.html" role="menuitem">Accessibility</a></li><li role="presentation"><a href="/ai-copyright.html" role="menuitem">AI and Copyright Policy</a></li><li role="presentation">               <a href="/privacy.html" role="menuitem">Privacy Policy</a></li></ul></div></div><div class="row center"><div class="h1"><a href="./" title="Home"><img src="/assets/images/logo-wide.png" alt="Logo"></a></div></div></div></div></div><div id="webgl-wrapper"><a id="exitSign" href="#"><img src="/assets/back.svg" title="Return to the previous screen" width="300" height="85" alt="Arrow sign saying this leads back"></a><iframe id="pageOverlay"></iframe><div id="webgl"></div><script id="vertexshader" type="x-shader/x-vertex">varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}</script><script id="fragmentshader" type="x-shader/x-fragment">// Kudos to https://github.com/mrdoob/three.js/issues/14104#issuecomment-1536582334
uniform sampler2D baseTexture;
uniform sampler2D bloomTexture;
varying vec2 vUv;
void main() {
    vec4 base_color = texture2D(baseTexture, vUv);
    vec4 bloom_color = texture2D(bloomTexture, vUv);
    float lum = 0.21 * bloom_color.r + 0.71 * bloom_color.g + 0.07 * bloom_color.b;
    gl_FragColor = vec4(base_color.rgb + bloom_color.rgb, max(base_color.a, lum));
}
</script><script type="importmap">{
    "imports": {
        "postprocessing": "/vendor/postprocessing.js",
        "three": "/vendor/three.module.js",
        "three/": "/vendor/three/",
        "three-bvh-csg": "/vendor/three-bvh-csg.js",
        "three-mesh-bvh": "/vendor/three-mesh-bvh.js",
        "virtual_office/": "/assets/scripts/virtual_office/"
    }
}
</script><script src="/assets/scripts/L.js"></script><script>/**
 * Poke Matrix
 * 
 * Pocket sized loading effect.
 * 
 */

const charArr = ['ã¢', 'ã¨', 'ã¤', 'ã­', 'ãª', 'ã«', '7', 'ã±', 'ãµ', 'ã¹', 'z', '1', '5', '2', 'ã¨', 'ã¿', 'ã¯', '4', 'ã', 'ã', 'ã', '9', '8', 'ã', '0', 'ã', 'ã¢', '3', 'ã¦', ' ', 'ã»', 'Â¦', ':', '"', 'ê', 'ã', 'ã©', 'ãª', 'â', 'ã', 'ã', 'ã', 'ã', 'ã½', 'âª', 'â', '<', '>', '0', '|', '+', '*', 'ã³', 'ã·', 'ã', 'ã ', 'ã¡'];

const backgroundImage = new Image();
let isDesktop = window.innerWidth > 640;
backgroundImage.src = isDesktop ? document.getElementById('exit_image').src : document.getElementById('exit_image_mobile').src  ;

const webgl = document.getElementById('webgl');
webgl.style.filter = 'saturate(0)';

const canvas = document.getElementById('pokematrixCanvas');
const ctx = canvas.getContext('2d');
const canvas2 = document.getElementById('pokematrixImage');
canvas2.style.display = 'none';
const ctx2 = canvas2.getContext('2d', {
    willReadFrequently: true
});

let exitButton = document.getElementById('pokematrixSign');

let w = canvas.width = canvas2.width = exitButton.offsetWidth + 10;
let h = canvas.height = canvas2.height = exitButton.offsetHeight + 10;

const largeScreen = canvas.width * canvas.height < 2000000;
const portraitMode = canvas.width < canvas.height;
const fontSize = (portraitMode || largeScreen) ? 2 : 2;

let cols = Math.floor(w / fontSize ) + 1;
let ypos = Array(cols).fill(0);

window.matrix_scene = {
    type: 'button',
    interval: false,
    complete: false,
    currentTime: 0,
    lastTime: 0,
    /**
     * Stages:
     *  - 0 Intro - load virtual office
     *  - 1 Fill viewport with numbers - load virtual office assets
     *  - 2 Buy time to fill the matrix (if it loaded from cache / too fast)
     *  - 3 Enter the matrix - start
     */
    stage: 0,
    /**
     * Timestamp when the current stage began.
     */
    stageStarted: 0,
    /**
     * Stage specific variables.
     */
    // Stage 0
    elapsed: 0,
    // Stage 1
    loaded_done: 0,
    loaded_target: 0,
    // Stage 2
    transition_total: 1250, // in milliseconds

    // Animates the scene
    animate: function (currentTime) {
        const elapsedSinceLast = currentTime - window.matrix_scene.lastTime;
        window.matrix_scene.currentTime = currentTime;
        window.matrix_scene.elapsed += window.matrix_scene.currentTime - window.matrix_scene.lastTime;
        window.matrix_scene.lastTime = currentTime;
        drawBackground();

        ctx.font = fontSize + 'pt monospace';

        if (window.matrix_scene.stage == 0) {
            ctx.fillStyle = "rgba(0,0,0,0.00125)";
            ctx.fillRect(0, 0, w, h);
            // @todo: implement the intro sequence here - column reduce?

            ypos.forEach((y, ind) => {

                window.matrix_scene.drawSymbol(y, ind);



                if ((y > 1 + randomInt(1, window.matrix_scene.elapsed))) ypos[ind] = 0;
                else ypos[ind] = y + fontSize;

            });
        }
        if (window.matrix_scene.stage == 1) {
            ctx.fillStyle = "rgba(0,0,0,0.0025)";
            ctx.fillRect(0, 0, w, h);
            ypos.forEach((y, ind) => {
                window.matrix_scene.drawSymbol(y, ind);

                if (y > 1 + randomInt(1, 2000 * window.matrix_scene.loaded_done)) ypos[ind] = 0;
                else ypos[ind] = y + fontSize;

            });

        }
        if (window.matrix_scene.stage == 2) {
            ctx.fillStyle = "rgba(0,0,0,0.005)";
            ctx.fillRect(0, 0, w, h);

            ypos.forEach((y, ind) => {
                window.matrix_scene.drawSymbol(y, ind);

                if ((y > 1 + randomInt(1, window.matrix_scene.elapsed))) ypos[ind] = 0;
                else ypos[ind] = y + fontSize;

            });

        }
        if (window.matrix_scene.stage == 3) {

            ctx.fillStyle = "rgba(0,0,0,0.005)";
            ctx.fillRect(0, 0, w, h);
            ypos.forEach((y, ind) => {
                window.matrix_scene.drawSymbol(y, ind);

                if ((y > 1 + randomInt(1, window.matrix_scene.elapsed))) ypos[ind] = 0;
                else ypos[ind] = y + fontSize;

            });
        }

        if (!window.matrix_scene.complete) {
            requestAnimationFrame(window.matrix_scene.animate);
        }
    },
    drawSymbol: function (y, ind) {
        const text = charArr[randomInt(0, charArr.length - 1)].toUpperCase();
        const x = ind * fontSize * 1.5;

        ctx.fillStyle = getAverageColor(ctx2, x, y);
        ctx.fillText(text, x, y);
    },
    // Updates the scene
    updateStage: function () {
        if (window.matrix_scene.stage == 0) {
            if (window.virtual_office && (Date.now() - window.matrix_scene.stageStarted > 500)) {
                window.matrix_scene.stage = 1;
                window.matrix_scene.stageStarted = Date.now();
                for (var measure in window.virtual_office.loaders.stats) {
                    window.matrix_scene.loaded_target += window.virtual_office.loaders.stats[measure].target;
                }

            }
        }
        if (window.matrix_scene.stage == 1) {
            window.matrix_scene.loaded_done = 0;
            for (var measure in window.virtual_office.loaders.stats) {
                window.matrix_scene.loaded_done += window.virtual_office.loaders.stats[measure].loaded;
            }

            if (
                window.matrix_scene.loaded_done == window.matrix_scene.loaded_target && (Date.now() - window.matrix_scene.stageStarted > 500)
            ) {
                window.matrix_scene.stage = 2;
                window.matrix_scene.stageStarted = Date.now();
            }
        }
        if (window.matrix_scene.stage == 2) {
            if (
                window.virtual_office.ready == true &&
                (Date.now() - window.matrix_scene.stageStarted > 500)
            ) {
                window.matrix_scene.stage = 3;
                window.matrix_scene.stageStarted = Date.now();
                canvas.style.transition = 'filter 2.5s, transform 2.5s, opacity 2.5s';
                canvas.style.transform = "scale(5)";
                canvas.style.filter = "blur(5px)";
                canvas.style.opacity = 0;

                exitButton.style.transition = 'opacity 2s';
                exitButton.style.opacity = 1;
            }
        }
        if (window.matrix_scene.stage == 3) {
            if (
                (Date.now() - window.matrix_scene.stageStarted) > window.matrix_scene.transition_total
            ) {
                clearInterval(window.matrix_scene.interval);
                canvas.style.display = 'none';
                exitButton.addEventListener( 'click', downTheRabbitHole);
            }
        }
    },
    // Start
    start: function () {
        ctx.fillStyle = "rgba(0,0,0,0)";
        ctx.fillRect(0, 0, w, h);

        window.addEventListener('orientationchange', handleViewportChange);
        window.addEventListener('resize', handleViewportChange);

        window.matrix_scene.stageStarted = Date.now();
        window.matrix_scene.interval = setInterval(window.matrix_scene.updateStage, 100);
        requestAnimationFrame(window.matrix_scene.animate);
    }
};

function downTheRabbitHole() {
    window.virtual_office.started = true;
    if ( window.scrollY != 0 ) {
        window.scrollTo(0, 0);
    }
    document.title = 'Open Studios | Perth, Western Australia';
    const pageWrapper = document.getElementById('page-wrapper');
    
    pageWrapper.style.opacity = 1;
    pageWrapper.style.transition = 'opacity 1s';
    pageWrapper.style.opacity = 0;

    // Hide the pageWrapper on completion so the iframed pages don't clash.
    setTimeout( () => {
        window.matrix_scene.complete = true;
         pageWrapper.style.display = 'none';
         pageWrapper.style.pointerEvents = 'none';

        // Animate the camera resetting from any other position.
        window.virtual_office.tweens.resetCameraRotation.start();
        window.virtual_office.tweens.resetCameraPosition.start();
    }, 1000);

    webgl.style.transition = 'filter 3s 2s, opacity 4s';
    webgl.style.filter = "saturate(1)";
    webgl.style.opacity = 1;

    // Hide body element scrollbars as the 3D viewport takes over.
    document.querySelector("body").style.overflow = 'hidden';

}

// Function to draw the background image
function drawBackground() {
    var scale = isDesktop ? 1 : 0.8;

    var scaledWidth =  canvas.width * scale;
    var scaledHeight =  canvas.height * scale;

    // Calculate the top-left coordinates of the image to center it
    var imageX =  (w - scaledWidth) / 2;
    var imageY = 2.5 + (h - scaledHeight) / 2;

    if (!isDesktop) {
        imageX += ( 0.1 ) * canvas.width;
        imageY -= ( 0.1 ) * canvas.height;
    }

    // Draw the image on the canvas at the calculated position
    ctx2.drawImage(backgroundImage, imageX, imageY, scaledWidth, scaledHeight);
}

function getAverageColor(context, x, y) {
    const imageData = context.getImageData(x, y, 5, 5).data;
    let r = 0,
        g = 0,
        b = 0;
    let randomDelta = Math.tan(randomInt(1, 50)) * 2;
    for (let i = 0; i < imageData.length; i += 4) {
        r += imageData[i] + randomDelta;
        g += imageData[i + 1] + randomDelta;
        b += imageData[i + 2] + randomDelta;
    }
    const count = imageData.length / 4;
    if (Math.floor(g / count) <=0 ) {
        return `rgba(0,0,0,0.0001)`;
        
    }
    else {
        return `rgb(${Math.floor(r / count)}, ${Math.floor(g / count)}, ${Math.floor(b / count)})`;
    }
}


function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min) + min);
}

function handleViewportChange() {

    w = canvas.width = canvas2.width = exitButton.offsetWidth;
    h = canvas.height = canvas2.height = exitButton.offsetHeight;
    cols = Math.floor(w / fontSize) + 1;
    ypos = Array(cols).fill(0);

    ctx.fillStyle = '#0000';
    ctx.fillRect(0, 0, w, h);

    isDesktop = window.innerWidth > 640;
    backgroundImage.src = isDesktop ? document.getElementById('exit_image').src : document.getElementById('exit_image_mobile').src  ;
}</script><script>var _paq = window._paq = window._paq || [];
/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);
(function() {
var u="https://analytics.openstudios.xyz/";
_paq.push(['setTrackerUrl', u+'matomo.php']);
_paq.push(['setSiteId', '11']);
var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
})();</script></div></body></html>