[{"id":33,"date":"2024-09-20T01:01:48","date_gmt":"2024-09-19T17:01:48","guid":{"rendered":"https://portal.openstudios.xyz/?p=33"},"modified":"2024-09-28T20:54:38","modified_gmt":"2024-09-28T12:54:38","slug":"how-to-implement-blender-principled-bsdf-materials-in-three-js-webgl","status":"publish","type":"post","link":"https://portal.openstudios.xyz/how-to-implement-blender-principled-bsdf-materials-in-three-js-webgl/","title":{"rendered":"How to implement Blender Principled BSDF Materials in Three.js (WebGL)"},"content":{"rendered":"\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1773\" height=\"998\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-21-042909-Large-edited.png\" alt=\"\" class=\"wp-image-152\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-21-042909-Large-edited.png 1773w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-21-042909-Large-edited-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-21-042909-Large-edited-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-21-042909-Large-edited-768x432.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-21-042909-Large-edited-1536x865.png 1536w\" sizes=\"(max-width: 1773px) 100vw, 1773px\" /></figure>\n\n\n\n<p></p>\n\n\n\n<h3 class=\"wp-block-heading\">Introduction to Physically Based Rendering and Shaders</h3>\n\n\n\n<p>Achieving realism in computer graphics requires a phenomenal amount of computing power. In order to reduce that workload, 3D graphics uses techniques like Physically Based Rendering (PBR), which simulates the realistic way that light interacts with surfaces. PBR relies on image-based data which can enhance a surface with additional detail using precalculated image-based representations of different properties. For example, the metallic map defines which areas of a texture are more reactive to light reflection.</p>\n\n\n\n<p>Implementing PBR in real-time environments like web browsers presents additional challenges. Web technologies, such as WebGL, have more constraints compared to desktop software APIs like OpenGL. Compared to Three.js, Blender has more flexibility and more advanced rendering options that can be applied without concern for performance overhead. Shaders, the small programs that run on the GPU, can play a critical role in bridging this gap, allowing developers to create custom effects, lighting models, and procedural textures that can approximate a great level of detail without sacrificing performance.</p>\n\n\n\n<p>In this article, I’ll walk through the process of creating physically based materials for a web game using Three.js and custom shaders, showcasing both the obstacles and breakthroughs involved in adapting complex materials originally designed in Blender to run efficiently in a browser environment.</p>\n\n\n\n<p></p>\n\n\n\n<h3 class=\"wp-block-heading\">Designing physically based materials for the web</h3>\n\n\n\n<p>As part of my recent sprint on the <em>Open Studios </em>project <em>Langenium</em>, I worked on a <a href=\"https://github.com/OpenStudiosCo/Langenium/issues/39\">ticket</a> called &#8220;Basic Scenery&#8221;. While models have come and gone over the history of this project, the game has retained only one model for the player&#8217;s avatar and one for background scenery, both developed for the original <em>Langenium </em>project back in 2012 so they were noticeably lacking in detail.</p>\n\n\n\n<p>Originally I thought I&#8217;d add some common materials to the game using free materials from online resources like <a href=\"https://freepbr.com/\">FreePBR</a>, however for ease of use I opted to use free materials provided by the <a href=\"https://www.blenderkit.com/\">BlenderKit</a> add-on. Unfortunately the models exported for use in the game engine had no textures despite the materials being ticked for export. After some Googling I learned that I had to &#8220;bake&#8221; the shader materials in order for them to be exported and loaded in other environments like Three.js.</p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"2128\" height=\"948\" src=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725.png\" alt=\"\" class=\"wp-image-43\" style=\"width:840px;height:auto\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725.png 2128w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725-300x134.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725-1024x456.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725-768x342.png 768w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725-1536x684.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220725-2048x912.png 2048w\" sizes=\"(max-width: 2128px) 100vw, 2128px\" /><figcaption class=\"wp-element-caption\"><em>The Union Platform Model enhanced with a couple of free materials from the BlenderKit materials library. </em></figcaption></figure></div>\n\n\n<p>Baking the materials fixed the issue and allowed shader material textures to export from Blender, but the file sizes had grown from 170KB to 30MB, which isn’t acceptable for a web based game. Even if I could get away with one model, the cumulative effect of several models that size would mean people on mobile can&#8217;t play. Worse yet &#8211; the textures, even with good compression, were blurry and no longer dynamically reacting to directional light, or showing animations. That file size is pretty standard in video games but it just wasn&#8217;t acceptable given how much better everything looked in Blender where the materials were at a higher resolution and, most importantly, were animated and reacting to directional light.</p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"2560\" height=\"1392\" src=\"https://portal.openstudios.xyz/app/uploads/2024/08/image-2.png\" alt=\"\" class=\"wp-image-54\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/08/image-2.png 2560w, https://portal.openstudios.xyz/app/uploads/2024/08/image-2-300x163.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/image-2-1024x557.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/image-2-768x418.png 768w, https://portal.openstudios.xyz/app/uploads/2024/08/image-2-1536x835.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/08/image-2-2048x1114.png 2048w\" sizes=\"(max-width: 2560px) 100vw, 2560px\" /><figcaption class=\"wp-element-caption\"><em>Editing the <a href=\"https://www.blenderkit.com/asset-gallery-detail/484c0cf9-6ae7-4bb1-801d-8bf40e70e554/\">Procedural Abstract Sci-Fi Panels</a> material in Blender, used on the aircraft model.</em></figcaption></figure></div>\n\n\n<p>Having a bit of practise implementing my own shader based materials in Blender and Three.js, I realised it was probably possible to recreate the BlenderKit materials within a <a href=\"https://threejs.org/docs/#api/en/materials/ShaderMaterial\">THREE.ShaderMaterial</a>. My first attempt implemented <a href=\"https://nodetoy.co/\">NodeToy</a>. I got something resembling the material pretty quickly however when I went to use it I got a lot of errors in my game. NodeToy uses it&#8217;s own format for shaders so I couldn&#8217;t easily adapt what I&#8217;d created without the NodeToy add-on.</p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1233\" height=\"925\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-16-201726-edited-1.png\" alt=\"\" class=\"wp-image-82\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-16-201726-edited-1.png 1233w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-16-201726-edited-1-300x225.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-16-201726-edited-1-1024x768.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-16-201726-edited-1-768x576.png 768w\" sizes=\"(max-width: 1233px) 100vw, 1233px\" /></figure>\n\n\n\n<p>It was time to try a programmatic approach instead of relying on a 3rd party&#8217;s custom format.</p>\n\n\n\n<p></p>\n\n\n\n<h3 class=\"wp-block-heading\">Writing a custom shader material for a sci-fi aircraft</h3>\n\n\n\n<p>Blender is open source but written in Python and the shader code is written within a larger shader material framework designed specifically for use in Blender&#8217;s application framework. Programmatically speaking, it means I couldn&#8217;t just lift the shader code I needed and stitch them back into my code &#8211; there were lots of smaller variables and settings that had to be setup in order to use their code for things like the Voronoi function. Licensing meant I may not have the rights to just take that bit of code from Blender for my project. There also wasn&#8217;t a clear connection between some of the settings in the code and what was being used in the Blender application so I just had to write my own from scratch and build it up.</p>\n\n\n\n<p>To implement my own custom shader, I created a new ShaderMaterial (js code below) and added some script tags to my document that would contain the shader code. I cloned one of the existing game shaders as a boilerplate, gutted it down to a simple colour draw  (html/glsl code below) and got to work populating it with logic that corresponded to each node, and link, in the Blender shader material.</p>\n\n\n\n<p><strong>js</strong></p>\n\n\n\n<pre class=\"wp-block-code language-js has-white-color has-black-background-color has-text-color has-background has-link-color wp-elements-f6bd2a6dd401357ddda4302277742c6b\"><code>  let material = new THREE.ShaderMaterial( {\n    vertexShader: document.getElementById( 'proceduralBuildingVertShader' ).textContent,\n    fragmentShader: document.getElementById( 'proceduralBuildingFragShader' ).textContent,\n    uniforms: settings.uniforms\n  } );</code></pre>\n\n\n\n<p><strong>html/glsl</strong></p>\n\n\n\n<pre class=\"wp-block-code language-html has-white-color has-black-background-color has-text-color has-background has-link-color wp-elements-6d3e6dab6201cc4fd50b99fe4d416151\"><code>&lt;script type=\"x-shader/x-vertex\" id=\"proceduralBuildingVertShader\"&gt;\n    void main() {\n&nbsp; &nbsp;     gl_Position = vec4(position, 1.0);\n    }\n&lt;/script&gt;\n&lt;script type=\"x-shader/x-vertex\" id=\"proceduralBuildingFragShader\"&gt;\n    void main() {\n&nbsp; &nbsp;     gl_FragColor = vec4(vec3(0.5), 1.0);\n    }\n&lt;/script&gt;</code></pre>\n\n\n\n<p></p>\n\n\n\n<h4 class=\"wp-block-heading\">Replacing the Color Ramp node</h4>\n\n\n\n<p>Recreating the <a href=\"https://docs.blender.org/manual/en/latest/editors/texture_node/types/converter/color_ramp.html\">Colour Ramp node</a> was a matter of finding a GLSL gradient function I could adapt. Turning to Github I was fortunate to find an open source <a href=\"https://gist.github.com/tgfrerer/1640dd717e3ab1eada9f\">Gist</a> containing a variety of gradient functions I could use. After the gradient functions were in place to mimic the Color Ramp node, the material began to match what I was seeing in Blender.</p>\n\n\n\n<p>Searching Github can be very handy when you need to know how specific API&#8217;s or functions are implemented by other coders. Especially when you&#8217;re working on something a bit niche and can&#8217;t documentation in other places like forums, tutorial videos and dev blogs.</p>\n\n\n\n<h4 class=\"wp-block-heading\">Replacing the Voronoi texture node</h4>\n\n\n\n<p>Voronoi textures are a popular tool for computer graphics, their cellular shapes can be made to resemble a number of artificial and natural structures. Within the material shaders I&#8217;m using, the cells from Voronoi textures are used to define structure and metal panels covering the surface of the aircraft.</p>\n\n\n\n<p>I&#8217;ve never been good at maths and certainly it&#8217;s a bit beyond my ability to just write my own Voronoi functions from scratch. Learning how to do all this is certainly possible, but there had to be some kind of useful resource out there that could give me a leg up rather than losing months of my life to that.</p>\n\n\n\n<p>Mercifully <a href=\"https://github.com/kinakomoti-321/Voronoi_textures\">someone had migrated the Voronoi function to native GLSL</a> which gave me a good starting point. Once I got my own Voronoi function setup, it wasn&#8217;t too hard to complete the remainder of the shader materials to achieve an initial result on the player&#8217;s aircraft. Only one layer of the material is present in the screenshot below, the white lines, but with just that you can already see details emerge.</p>\n\n\n\n<p>The shape of the Voronoi cells in my output didn&#8217;t quite match the original material &#8211; the BlenderKit material had metal panels made up of smaller shapes, while the most complex shapes I was initially creating were mostly whitespace with a few squares and triangles.</p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1686\" height=\"685\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-17-153223.png\" alt=\"\" class=\"wp-image-80\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-17-153223.png 1686w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-17-153223-300x122.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-17-153223-1024x416.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-17-153223-768x312.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-17-153223-1536x624.png 1536w\" sizes=\"(max-width: 1686px) 100vw, 1686px\" /><figcaption class=\"wp-element-caption\"><em>The first test of the new custom shader which combined the Voronoi texture with a black/white gradient</em>.</figcaption></figure></div>\n\n\n<p>Debugging what&#8217;s going on within shaders in Blender is a matter of reconnecting nodes to inspect their respective outputs. Doing so with code is pretty similar, I changed the <em>gl_FragColor </em>to be the <em>voronoi.rgb</em> value until I got the mapping correct so that the shapes matched. The exact forms are a little bit different; I&#8217;m getting slightly more angular shapes instead of the cleaner cut straight angles of <a href=\"https://docs.blender.org/manual/en/latest/render/shader_nodes/textures/voronoi.html\">Blender&#8217;s Voronoi Texture node</a> but it was good enough for my purposes here.</p>\n\n\n\n<div class=\"wp-block-columns is-layout-flex wp-container-core-columns-is-layout-1 wp-block-columns-is-layout-flex\">\n<div class=\"wp-block-column is-layout-flow wp-block-column-is-layout-flow\">\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1051\" height=\"591\" src=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-233011-edited.png\" alt=\"\" class=\"wp-image-52\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-233011-edited.png 1051w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-233011-edited-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-233011-edited-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-233011-edited-768x432.png 768w\" sizes=\"(max-width: 1051px) 100vw, 1051px\" /></figure>\n</div>\n\n\n\n<div class=\"wp-block-column is-layout-flow wp-block-column-is-layout-flow\">\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1346\" height=\"756\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/image-1-edited.png\" alt=\"\" class=\"wp-image-85\" style=\"width:417px;height:auto\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/image-1-edited.png 1346w, https://portal.openstudios.xyz/app/uploads/2024/09/image-1-edited-300x168.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/image-1-edited-1024x575.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/image-1-edited-768x431.png 768w\" sizes=\"(max-width: 1346px) 100vw, 1346px\" /></figure>\n</div>\n</div>\n\n\n\n<p>I tried for a while to match the Voronoi Texture output variables in GLSL code to the same outputs in Blender&#8217;s Voronoi Texture. This was important for recreating the same metal panelling shapes seen in the BlenderKit material. Blender was automatically normalising the RGB output to a grey colour, which I was able to recreate with a simple one liner provided by ChatGPT.</p>\n\n\n\n<pre class=\"wp-block-code language-glsl has-white-color has-black-background-color has-text-color has-background has-link-color wp-elements-f06dd06019129b65fe12b9041b864d2b\"><code>float gray = dot(voronoiValue.rgb, vec3(0.2126, 0.7152, 0.0722));\ngray = ( gray - 0.5 ) * 0.2;</code></pre>\n\n\n\n<p></p>\n\n\n\n<h4 class=\"wp-block-heading\">Debugging Custom Shaders</h4>\n\n\n\n<p>Writing custom shaders can be a challenging process, especially when things don’t work as expected. Shaders run within the GPU hardware making them notoriously difficult to debug since there&#8217;s no straightforward way to log variables or print errors like you would in traditional programming languages. Instead, you rely heavily on visual feedback and careful analysis of your code. Here are some things to keep in mind when debugging your own custom shaders.</p>\n\n\n\n<ol class=\"wp-block-list\">\n<li><strong>Visualizing Outputs</strong>\n<ul class=\"wp-block-list\">\n<li>One of the simplest yet most effective ways to debug shaders is visualizing calculated outputs directly in your scene. For instance, if you&#8217;re trying to understand what&#8217;s happening with a particular texture, uniform, or math operation, you can assign the value you&#8217;re working on directly to <em>gl_FragColor </em>in the fragment shader.</li>\n\n\n\n<li>Many shader effects rely on the mathematical operations between variables that are themselves calculated elsewhere, so visualising what these individual components are doing can help move things along better than just trying endless variations of your original code.</li>\n</ul>\n</li>\n\n\n\n<li><strong>Simplifying the Shader</strong>\n<ul class=\"wp-block-list\">\n<li>When complex shaders crash your application or fail to compile, it helps to break the problem down by simplifying your shader code. Start by reducing it to a basic state (e.g., simple colour rendering) and then gradually reintroduce features like textures, lighting, and animation effects. This incremental approach lets you isolate the issue and ensures that you always have a working base to return to.</li>\n\n\n\n<li>For example, when having issues with using my Voronoi texture as a mask, I gutted the original shader and started with a simple colour draw before adding each feature one at a time. This method made it easier to identify where things were going wrong as I reintroduced individual components.</li>\n\n\n\n<li>This kind of step-by-step approach also keeps the shader manageable, allowing you to optimize as you go. Comprehending how a shader works can be confusing due to their per pixel nature, i.e. the entire Fragment shader runs for each pixel for each frame.</li>\n</ul>\n</li>\n\n\n\n<li><strong>Setup for visual inspection</strong>\n<ul class=\"wp-block-list\">\n<li>As part of this ticket, I extended the game engine with a debugging mode. When activated a scene outline appears along with performance stats and editor tools like <a href=\"https://threejs.org/docs/#examples/en/controls/OrbitControls\">orbit controls</a>.</li>\n\n\n\n<li>I used the debugging mode to switch the game from player controls to the orbit controls and targeted the object in question which allowed me to easily inspect it from multiple angles and distances.</li>\n\n\n\n<li>For testing out geometry / vertex displacement, it was handy to switch into wireframe mode to see the exact effect that changes were having on objects.</li>\n</ul>\n</li>\n\n\n\n<li><strong>WebGL Limits</strong>\n<ul class=\"wp-block-list\">\n<li>Finally, remember that 3D on the web has certain limitations compared to desktop-based graphics applications like Blender. You may encounter limitations with precision, texture formats, and how geometry is handled. For example, WebGL shaders might not support some complex procedural textures or displacement effects that work in Blender. Instead, you can use alternatives such as pre-calculated textures or vertex shaders to handle some of the geometry calculations.</li>\n</ul>\n</li>\n</ol>\n\n\n\n<p></p>\n\n\n\n<h4 class=\"wp-block-heading\">Comparing Blender shader material to final code</h4>\n\n\n\n<p>This annotated screenshot shows the original material in Blender and how it relates to the new Procedural Metal fragment shader. Here&#8217;s what&#8217;s going on:</p>\n\n\n\n<ul class=\"wp-block-list\">\n<li><strong>Red</strong>: Voronoi Texture generation, creates the metal panelling shapes</li>\n\n\n\n<li><strong>Blue</strong>: Creates the first gradient filter which draws white lines on the aircraft surface</li>\n\n\n\n<li><strong>Green</strong>: Creates the second gradient filter which draws red lines on the aircraft surface</li>\n\n\n\n<li><strong>Yellow</strong>: Merges all the outputs into a single colour using PBR techniques</li>\n\n\n\n<li><strong>Magenta</strong>: Creates a displacement map that simulates ridges between metal panels</li>\n\n\n\n<li><strong>Cyan</strong>: Sends the output to the shader for display</li>\n</ul>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"3840\" height=\"2160\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation.png\" alt=\"\" class=\"wp-image-83\" style=\"width:840px;height:auto\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation.png 3840w, https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation-768x432.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation-1536x864.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/09/2024-09-18-Shader-Translation-2048x1152.png 2048w\" sizes=\"(max-width: 3840px) 100vw, 3840px\" /></figure></div>\n\n\n<p></p>\n\n\n\n<h4 class=\"wp-block-heading\">Side by side comparison</h4>\n\n\n\n<p>The Procedural Metal material isn&#8217;t an exact match to the original one from BlenderKit, however it&#8217;s more than enough for this stage of the project. </p>\n\n\n\n<div class=\"wp-block-columns is-layout-flex wp-container-core-columns-is-layout-2 wp-block-columns-is-layout-flex\">\n<div class=\"wp-block-column is-layout-flow wp-block-column-is-layout-flow\">\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"960\" height=\"540\" src=\"https://portal.openstudios.xyz/app/uploads/2024/08/image-3.png\" alt=\"\" class=\"wp-image-55\" style=\"width:428px;height:auto\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/08/image-3.png 960w, https://portal.openstudios.xyz/app/uploads/2024/08/image-3-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/image-3-768x432.png 768w\" sizes=\"(max-width: 960px) 100vw, 960px\" /></figure>\n</div>\n\n\n\n<div class=\"wp-block-column is-layout-flow wp-block-column-is-layout-flow\">\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1457\" height=\"895\" src=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-173514.png\" alt=\"\" class=\"wp-image-39\" style=\"width:393px;height:auto\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-173514.png 1457w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-173514-300x184.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-173514-1024x629.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-18-173514-768x472.png 768w\" sizes=\"(max-width: 1457px) 100vw, 1457px\" /></figure>\n</div>\n</div>\n\n\n\n<p>The full source code for the new aircraft material, known in Langenium&#8217;s codebase as the Procedural Metal shader, is open source and available on Github via the links below.</p>\n\n\n\n<ul class=\"wp-block-list\">\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralMetal.vert\">Procedural Metal Vertex shader</a></li>\n\n\n\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralMetal.frag\">Procedural Metal Fragment shader</a></li>\n</ul>\n\n\n\n<p></p>\n\n\n\n<h3 class=\"wp-block-heading\">Writing a customer shader material for a futuristic sci-fi city</h3>\n\n\n\n<p>Now that the main player aircraft was starting to look like it does in Blender, it was time to work on the game&#8217;s futuristic city. This model uses three different procedural materials &#8211; <a href=\"https://www.blenderkit.com/asset-gallery-detail/9430fd1f-a2cd-4df6-ae1d-0ba2ad84b5de/\">Procedural Scifi Greeble</a> for the city&#8217;s chassis and megastructure, a modified <a href=\"https://www.blenderkit.com/asset-gallery-detail/c23680d6-fde9-441c-bab2-99922f4686bc/\">Procedural Scifi Alien Metal Green</a> for the buildings and <a href=\"https://www.blenderkit.com/asset-gallery-detail/e92512fb-12b5-4142-878a-c12a5c9f70a0/\">Solar Panel</a> material for the six enormous ones protruding from the city.</p>\n\n\n\n<p>All the materials used by the city called for the Colour Ramp node, the buildings and chassis also required the Voronoi Texture node and a Brick Texture node. It was time to write my own Brick Texture function.</p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1719\" height=\"1312\" src=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193702.png\" alt=\"\" class=\"wp-image-46\" style=\"width:840px;height:auto\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193702.png 1719w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193702-300x229.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193702-1024x782.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193702-768x586.png 768w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193702-1536x1172.png 1536w\" sizes=\"(max-width: 1719px) 100vw, 1719px\" /></figure>\n\n\n\n<p></p>\n\n\n\n<h4 class=\"wp-block-heading\">Recreating the Brick Texture node</h4>\n\n\n\n<p>The <a href=\"https://docs.blender.org/manual/en/latest/render/shader_nodes/textures/brick.html\">Brick Texture</a> node provides the square shape for metal panelling in the Procedural Scifi Greeble material used by the city&#8217;s megastructure/cradle/chassis. This texture node draws a brick like grid with optionally offset rows and other settings for things like gutter widths. As it was pretty easy to conceptualize, I got ChatGPT to help me recreate the Brick Texture in GLSL. The current result isn&#8217;t an exact recreation of what was in Blender but once again it&#8217;s close enough.</p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"1388\" height=\"886\" src=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220826.png\" alt=\"\" class=\"wp-image-45\" style=\"width:840px;height:auto\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220826.png 1388w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220826-300x191.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220826-1024x654.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-19-220826-768x490.png 768w\" sizes=\"(max-width: 1388px) 100vw, 1388px\" /></figure>\n\n\n\n<p></p>\n\n\n\n<h4 class=\"wp-block-heading\">Side by side comparison and final result</h4>\n\n\n\n<p>There were two major differences between the Blender version and the final result I got. I wasn&#8217;t able to get the same shapes on the city&#8217;s buildings, potentially because I am using WebGL compatible Voronoi and Brick texture code that differ too much from Blender. The other difference is the displacement map doesn&#8217;t affect vertices as nicely in the game as it does in Blender. This is something I might be able to work on but I currently don&#8217;t really want to delve too deep into getting that right now due to the functions I needed to draw the textures not being available in the vertex shader. I found this out when I tried to migrate the Voronoi and Brick texture code into the vertex shader but just couldn&#8217;t get it to work.</p>\n\n\n\n<p>The problem is that in WebGL / real time graphics there is a more rigid rendering order and pipeline than Blender. As a 3D graphics design tool, Blender can implement a material shader node that modifies geometry because it&#8217;s not trying to maintain 60 FPS (Frames Per Second). It might be possible to implement some additional logic to make Three.js support this, perhaps even just by modifying the actual texture code&#8230; but that&#8217;s just a rabbit hole I don&#8217;t want to deal with right now.</p>\n\n\n\n<div class=\"wp-block-columns is-layout-flex wp-container-core-columns-is-layout-3 wp-block-columns-is-layout-flex\">\n<div class=\"wp-block-column is-layout-flow wp-block-column-is-layout-flow\">\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1019\" height=\"573\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-060854-edited.png\" alt=\"\" class=\"wp-image-86\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-060854-edited.png 1019w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-060854-edited-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-060854-edited-768x432.png 768w\" sizes=\"(max-width: 1019px) 100vw, 1019px\" /></figure>\n</div>\n\n\n\n<div class=\"wp-block-column is-layout-flow wp-block-column-is-layout-flow\">\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1119\" height=\"630\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-193442-edited-1.png\" alt=\"\" class=\"wp-image-88\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-193442-edited-1.png 1119w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-193442-edited-1-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-193442-edited-1-1024x577.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-22-193442-edited-1-768x432.png 768w\" sizes=\"(max-width: 1119px) 100vw, 1119px\" /></figure>\n</div>\n</div>\n\n\n\n<p>Overall I&#8217;m happy with how the city ended up looking, the entire model reacts nicely to the environments lighting model and has set the aesthetic for structures in the environment.</p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1390\" height=\"887\" src=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193544.png\" alt=\"\" class=\"wp-image-40\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193544.png 1390w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193544-300x191.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193544-1024x653.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-22-193544-768x490.png 768w\" sizes=\"(max-width: 1390px) 100vw, 1390px\" /></figure>\n\n\n\n<p>The full source code for the procedural city materials are open source and available on Github via the links below.</p>\n\n\n\n<ul class=\"wp-block-list\">\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralSolarPanel.vert\">Solar Panel Vertex shader</a></li>\n\n\n\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralSolarPanel.frag\">Solar Panel Fragment shader</a></li>\n\n\n\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralBuilding.vert\">City Building Vertex shader</a></li>\n\n\n\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralBuilding.frag\">City Building Fragment shader</a></li>\n\n\n\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralMetal2.vert\">City Chassis Vertex shader</a></li>\n\n\n\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/proceduralMetal2.frag\">City Chassis Fragment shader</a></li>\n</ul>\n\n\n\n<p></p>\n\n\n\n<h3 class=\"wp-block-heading\">Programmatically setting transparent areas in a shader surface</h3>\n\n\n\n<p>I&#8217;d thought about what kind of interesting objects I could place on the ocean&#8217;s surface that made sense with the game lore, and came up with the idea of these giant industrial wells with an opening you can see from above that reaches below the water level. Now that I had a bit of practise with writing shader code, I decided to tackle cutting shapes out of the ocean. I&#8217;m using the <a href=\"https://threejs.org/examples/webgl_water.html\">THREE.Water</a> for the ocean&#8217;s surface and opted to just hack the inline GLSL used by that for now. I passed in a custom alpha map texture which would be used to determine whether to draw water or show transparency. To ensure the concept would work, I initially used a simple solid white PNG with a couple of solid black hearts.</p>\n\n\n\n<div class=\"wp-block-columns is-layout-flex wp-container-core-columns-is-layout-4 wp-block-columns-is-layout-flex\">\n<div class=\"wp-block-column is-layout-flow wp-block-column-is-layout-flow\">\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1984\" height=\"1116\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/test2-edited-1.png\" alt=\"\" class=\"wp-image-93\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/test2-edited-1.png 1984w, https://portal.openstudios.xyz/app/uploads/2024/09/test2-edited-1-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/test2-edited-1-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/test2-edited-1-768x432.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/test2-edited-1-1536x864.png 1536w\" sizes=\"(max-width: 1984px) 100vw, 1984px\" /></figure>\n</div>\n\n\n\n<div class=\"wp-block-column is-layout-flow wp-block-column-is-layout-flow\">\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1379\" height=\"776\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-021844-edited-1.png\" alt=\"\" class=\"wp-image-94\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-021844-edited-1.png 1379w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-021844-edited-1-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-021844-edited-1-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-021844-edited-1-768x432.png 768w\" sizes=\"(max-width: 1379px) 100vw, 1379px\" /></figure>\n</div>\n</div>\n\n\n\n<p>With the concept proven, I changed the shader uniforms to take in an array of co-ordinates of where the industrial wells would be. Within the shader, the co-ordinates were iterated and a hexagon was placed at each location and used as an alpha map to create the transparency in the ocean.</p>\n\n\n\n<p>Here are what those additions are in <a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/app/scenograph/materials/water.js\" data-type=\"link\" data-id=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/app/scenograph/materials/water.js\">my copy of THREE.Water</a>:</p>\n\n\n\n<pre class=\"wp-block-code language-glsl has-white-color has-black-background-color has-text-color has-background has-link-color wp-elements-852fd2a80e5a3156320504b7155c5a7d\"><code>// added to the uniforms section at the start of the shader\nuniform float submerged_objects&#91;${submergedObjectsFlattened.length}];\nuniform int submerged_objects_length;\n\n// added before the final gl_Fragcolor assignment in the main function\nfor (int i = 0; i &lt; submerged_objects_length; i += 3) {\n    float x = submerged_objects&#91;i];\n    float y = submerged_objects&#91;i + 1];\n    float radius = submerged_objects&#91;i + 2];\n\n    // Calculate the absolute distance from the center (x, y)\n    vec2 delta = abs(worldPosition.xz - vec2(x, y));\n\n    // Calculate the half-width of the octagon sides\n    float halfSideLength = radius / sqrt(2.0);\n\n    // Check if the point is within the octagon shape\n    if (\n        delta.x &lt; halfSideLength &amp;&amp;\n        delta.y &lt; halfSideLength &amp;&amp;\n        (delta.x + delta.y) &lt; radius\n    ) {\n        discard;\n    }\n}</code></pre>\n\n\n\n<p>If you&#8217;re unfamiliar with GLSL, the <code>discard</code> command tells the Fragment shader not to draw this fragment. This ended up being even cleaner than setting it to transparent.</p>\n\n\n\n<p>With the hole cut out, it was a trivial effort to chuck a hexagonal cylinder into the hole and use the city building material on it.</p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1394\" height=\"897\" src=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-24-031522.png\" alt=\"\" class=\"wp-image-62\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-24-031522.png 1394w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-24-031522-300x193.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-24-031522-1024x659.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-06-24-031522-768x494.png 768w\" sizes=\"(max-width: 1394px) 100vw, 1394px\" /></figure>\n\n\n\n<p></p>\n\n\n\n<h4 class=\"wp-block-heading\">Developing the custom structure using simple 3D geometry</h4>\n\n\n\n<p>The walls of the new structure looked a little thin and I wanted it to look convincing. The water line also clipped into the walls a little bit which wasn&#8217;t ideal, it&#8217;d occasionally glitch as you rotated the camera.</p>\n\n\n\n<p>Langenium uses a library called <a href=\"https://github.com/gkjohnson/three-bvh-csg\">three-bvh-csg</a> for Constructive Solid Geometry (CSG) features. These features can be used to do simple math operations on 3D Objects. I used CSG subtraction to subtract a smaller cylinder from the main structure, creating a thick wall which worked well to achieve the result I was after. The edges of the water are nicely covered and the structure looked complete.</p>\n\n\n\n<p>Looking to fill out the empty space a bit, I tried to add some storage tanks and dome shaped buildings but it just looked busy. I also had some fun with it and drew a face with the buildings.</p>\n\n\n\n<figure class=\"wp-block-gallery has-nested-images columns-default is-cropped wp-block-gallery-1 is-layout-flex wp-block-gallery-is-layout-flex\">\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1092\" height=\"671\" data-id=\"97\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-071541.png\" alt=\"\" class=\"wp-image-97\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-071541.png 1092w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-071541-300x184.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-071541-1024x629.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-071541-768x472.png 768w\" sizes=\"(max-width: 1092px) 100vw, 1092px\" /></figure>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1012\" height=\"714\" data-id=\"98\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-074247.png\" alt=\"\" class=\"wp-image-98\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-074247.png 1012w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-074247-300x212.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-24-074247-768x542.png 768w\" sizes=\"(max-width: 1012px) 100vw, 1012px\" /></figure>\n</figure>\n\n\n\n<p>In the end the structures didn&#8217;t add enough to justify their existence so I opted to just make the wells really deep so the effect would be dramatic if you fly over them in your aircraft.</p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"595\" height=\"335\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-08-25-041411-edited.png\" alt=\"\" class=\"wp-image-134\" style=\"width:840px;height:auto\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-08-25-041411-edited.png 595w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-08-25-041411-edited-300x169.png 300w\" sizes=\"(max-width: 595px) 100vw, 595px\" /></figure>\n\n\n\n<p></p>\n\n\n\n<h4 class=\"wp-block-heading\">The new structure</h4>\n\n\n\n<p>Playing around with alpha mapping, I was able to quickly creating a unique new asset for the game now called an Extractor. A key part of some gameplay ideas in the works, but more on that later.</p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1242\" height=\"705\" src=\"https://portal.openstudios.xyz/app/uploads/2024/08/image-6.png\" alt=\"\" class=\"wp-image-66\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/08/image-6.png 1242w, https://portal.openstudios.xyz/app/uploads/2024/08/image-6-300x170.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/image-6-1024x581.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/image-6-768x436.png 768w\" sizes=\"(max-width: 1242px) 100vw, 1242px\" /></figure>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1835\" height=\"862\" src=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-08-25-041352.png\" alt=\"\" class=\"wp-image-63\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-08-25-041352.png 1835w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-08-25-041352-300x141.png 300w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-08-25-041352-1024x481.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-08-25-041352-768x361.png 768w, https://portal.openstudios.xyz/app/uploads/2024/08/Screenshot-2024-08-25-041352-1536x722.png 1536w\" sizes=\"(max-width: 1835px) 100vw, 1835px\" /></figure>\n\n\n\n<p></p>\n\n\n\n<h3 class=\"wp-block-heading\">Creating new sci-fi structures with constructive solid geometry</h3>\n\n\n\n<p>Encouraged by the leaps and bounds the game environment had been enhanced by this work, I decided to add another object to the environment. Given the last one was an industrial &#8220;Extractor&#8221; I decide to name this next structure the Refinery. Using a tetrahedron as a base, I stretched, rotated it so one corner would face up and submerged it partly &#8211; to look like a futuristic pyramid floating on the water.</p>\n\n\n\n<p>To add complexity to the basic shape, I added a smaller inner tetrahedron with a different darker material and then used Constructive Solid Geometry to cut horizontal slices out of the outer shape. The outer object uses the city chassis material and the inner shape uses the city building materials.</p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1427\" height=\"802\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-035238-edited.png\" alt=\"\" class=\"wp-image-135\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-035238-edited.png 1427w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-035238-edited-300x169.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-035238-edited-1024x576.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-035238-edited-768x432.png 768w\" sizes=\"(max-width: 1427px) 100vw, 1427px\" /></figure>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1366\" height=\"681\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-162051-Medium.png\" alt=\"\" class=\"wp-image-136\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-162051-Medium.png 1366w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-162051-Medium-300x150.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-162051-Medium-1024x511.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-162051-Medium-768x383.png 768w\" sizes=\"(max-width: 1366px) 100vw, 1366px\" /></figure>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" width=\"951\" height=\"685\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-044923-edited.png\" alt=\"\" class=\"wp-image-95\" style=\"width:840px;height:auto\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-044923-edited.png 951w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-044923-edited-300x216.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-28-044923-edited-768x553.png 768w\" sizes=\"(max-width: 951px) 100vw, 951px\" /></figure>\n\n\n\n<p></p>\n\n\n\n<h3 class=\"wp-block-heading\">Creating new sci-fi vehicles with constructive solid geometry</h3>\n\n\n\n<p>Having the City, Refinery and Extractor structures in place I was inspired to add some transport ships that would travel in between them. Once again, using the new procedural shader materials and Constructive Solid Geometry, I created some chevron shapes. This result is quite simple but perfect as a background object that the player won&#8217;t really be too focused on up close.</p>\n\n\n\n<p>In the future, it would be good to add some additional geometry to these such as crew compartments and communication equipment you usually see on ships. For now, the result is good enough.</p>\n\n\n\n<figure class=\"wp-block-image size-large\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"665\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000932-Large-1024x665.png\" alt=\"\" class=\"wp-image-101\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000932-Large-1024x665.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000932-Large-300x195.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000932-Large-768x498.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000932-Large-1536x997.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000932-Large.png 1664w\" sizes=\"(max-width: 1024px) 100vw, 1024px\" /></figure>\n\n\n\n<figure class=\"wp-block-gallery has-nested-images columns-default is-cropped wp-block-gallery-2 is-layout-flex wp-block-gallery-is-layout-flex\">\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1920\" height=\"995\" data-id=\"100\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-001007-Large.png\" alt=\"\" class=\"wp-image-100\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-001007-Large.png 1920w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-001007-Large-300x155.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-001007-Large-1024x531.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-001007-Large-768x398.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-001007-Large-1536x796.png 1536w\" sizes=\"(max-width: 1920px) 100vw, 1920px\" /></figure>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1366\" height=\"708\" data-id=\"102\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000946-Large-Medium.png\" alt=\"\" class=\"wp-image-102\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000946-Large-Medium.png 1366w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000946-Large-Medium-300x155.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000946-Large-Medium-1024x531.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-09-19-000946-Large-Medium-768x398.png 768w\" sizes=\"(max-width: 1366px) 100vw, 1366px\" /></figure>\n</figure>\n\n\n\n<p></p>\n\n\n\n<h3 class=\"wp-block-heading\">Creating reusable shader fragments with Three.js</h3>\n\n\n\n<p>As this ticket progressed, I tried to figure out an optimal way to structure all the fragment shader code. I needed them to share common functions and clearly define what they&#8217;re doing in a main outline. Three.js doesn&#8217;t support GLSL includes but provides a mechanism called <a href=\"https://threejs.org/docs/#api/en/renderers/shaders/ShaderChunk\">ShaderChunk</a> that allows you to do essentially the same thing at runtime.</p>\n\n\n\n<p>Rather than including a file with a call like <code>#include voronoi.glsl</code>, the Three.js ShaderChunk uses variables and so I just had to use <code>#include &lt;voronoi&gt;</code> and declare the shader chunk variable. The Langenium engine implements a Materials class that does the following in its constructor to declare the shader chunk variables for compilation.</p>\n\n\n\n<pre class=\"wp-block-code language-glsl has-white-color has-black-background-color has-text-color has-background has-link-color wp-elements-c00066894ecc16f26fcabea0e50ebbf6\"><code>    // Initialise custom shader chunks.\n    const brickGLSL = document.getElementById( 'brickGLSL' ).textContent;\n    const gradientGLSL = document.getElementById( 'gradientGLSL' ).textContent;\n    const normalGLSL = document.getElementById( 'normalGLSL' ).textContent;\n    const voronoiGLSL = document.getElementById( 'voronoiGLSL' ).textContent;\n\n    THREE.ShaderChunk&#91; 'brick' ] = brickGLSL;\n    THREE.ShaderChunk&#91; 'gradient' ] = gradientGLSL;\n    THREE.ShaderChunk&#91; 'normal' ] = normalGLSL;\n    THREE.ShaderChunk&#91; 'voronoi' ] = voronoiGLSL;</code></pre>\n\n\n\n<p>In the screenshot below you can see the Procedural Metal Fragment shader along with the ShaderChunk variable includes it&#8217;s using &#8211; gradient, normal and voronoi.</p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"3840\" height=\"2112\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/image.png\" alt=\"\" class=\"wp-image-103\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/image.png 3840w, https://portal.openstudios.xyz/app/uploads/2024/09/image-300x165.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/image-1024x563.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/image-768x422.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/image-1536x845.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/09/image-2048x1126.png 2048w\" sizes=\"(max-width: 3840px) 100vw, 3840px\" /></figure>\n\n\n\n<p>The full source code for the common shader files and material class are open source and available on Github via the links below.</p>\n\n\n\n<ul class=\"wp-block-list\">\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/app/scenograph/materials.js\">Materials class</a>\n<ul class=\"wp-block-list\">\n<li>A common global used to declare materials in the Langenium engine</li>\n</ul>\n</li>\n\n\n\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/common/brick.glsl\">Brick</a>\n<ul class=\"wp-block-list\">\n<li>Provides functions that take inputs to create a brick pattern texture</li>\n</ul>\n</li>\n\n\n\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/common/gradient.glsl\">Gradient</a>\n<ul class=\"wp-block-list\">\n<li>Provides functions that take two or more colour inputs and creates a gradient</li>\n</ul>\n</li>\n\n\n\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/common/normal.glsl\">Normal</a>\n<ul class=\"wp-block-list\">\n<li>Provides functions that simulate displacement mapping and handle light direction</li>\n</ul>\n</li>\n\n\n\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/blob/master/client/src/shaders/common/voronoi.glsl\">Voronoi</a>\n<ul class=\"wp-block-list\">\n<li>Provides functions that take inputs to create cellular Voronoi graphs</li>\n</ul>\n</li>\n</ul>\n\n\n\n<p></p>\n\n\n\n<h3 class=\"wp-block-heading\">Caching shader materials in the browser</h3>\n\n\n\n<p>Looking to optimize the new materials, I had the idea to cache key data such as the noise maps, normal maps and Voronoi textures. Even if I couldn&#8217;t fit them into memory, modern technologies like the Web Storage API which could come in handy for caching procedurally generated files automatically optimised for and stored on a user&#8217;s device.</p>\n\n\n\n<p>To cache procedurally generated shader materials, I needed to render the texture images in a separate pass from the main loop. In my proof of concept, I applied the Procedural Metal shader to a flat mesh using PlaneGeometry and rendered the result onto a canvas element. To preview the cached texture separately from the 3D model, I displayed the canvas as an overlay.</p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"2554\" height=\"1271\" src=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627.png\" alt=\"\" class=\"wp-image-124\" srcset=\"https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627.png 2554w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627-300x149.png 300w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627-1024x510.png 1024w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627-768x382.png 768w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627-1536x764.png 1536w, https://portal.openstudios.xyz/app/uploads/2024/09/Screenshot-2024-06-20-230627-2048x1019.png 2048w\" sizes=\"(max-width: 2554px) 100vw, 2554px\" /></figure>\n\n\n\n<p>This approach was good enough to cover the mesh with texture sort of close but unfortunately the use of a PlaneGeometry meant it didn&#8217;t look the same in practise as a shader material that wrapped itself around the custom geometry of the aircraft model. When I tried to fix this issue, I discovered it wasn&#8217;t possible to export the custom surface details along with how they map to a custom model.</p>\n\n\n\n<p>In the future I definitely want to revisit this technique and try to complete the approach by caching the material mapping data. Even if that doesn&#8217;t work out, this approach could come in handy as an optimisation for objects that are too far away to see details on. When dozens of aircraft are in the scene, this could be an essential part of the strategy to optimising engine performance.</p>\n\n\n\n<p></p>\n\n\n\n<h3 class=\"wp-block-heading\">Summary</h3>\n\n\n\n<p>The new materials and objects have created a solid foundation that can be enhanced and extended in the future. In particular I would love to get geometry displacement and caching right. Achieving a displacement effect similar to Blender&#8217;s shader node may still be possible in the browser but it will probably be a significant challenge. Caching shader materials would allow advanced visuals and effects to be accessible on older and lower powered devices, as well as allowing for more overhead for even more advanced visuals on more powerful hardware.</p>\n\n\n\n<p>All the new assets produced in this piece of work have setup the game environment for actual gameplay features to now be added. Previous versions of Langenium had a Bullet Hell style approach, but in practise it was actually not very fun trying to line up shots in a straight line. That kind of play style might have been acceptable twenty or thirty years ago but not today. Especially on a mobile where you don&#8217;t have very good controls for fast reaction times to dodge attacks.</p>\n\n\n\n<p>Langenium is my love letter to my favourite video games and the game development scene at large, it includes gameplay ideas that mix real time strategy, role playing games (RPG) and aircraft simulators. With the new visuals, I believe the project has become elevated to a new height &#8211; the game is visually comparable to modern console and PC games that occupy tens to hundreds of gigabytes of storage.</p>\n\n\n\n<p>The next ticket is called Basic Gameplay and will introduce more UI development, pathfinding AI, enemy aircraft models, targeting overlays, missiles and damage systems. The final goal of this ticket is to have players control a protector aircraft for the cargo ships which will be under attack by hostile aircraft. Within the game&#8217;s story, cargo ships are transporting the titular Langenium element between extractors, refineries and the main city.</p>\n\n\n\n<p></p>\n\n\n\n<h3 class=\"wp-block-heading\">References and links</h3>\n\n\n\n<ul class=\"wp-block-list\">\n<li>Langenium Pull Request #42 \n<ul class=\"wp-block-list\">\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/pull/42\">https://github.com/OpenStudiosCo/Langenium/pull/42</a></li>\n</ul>\n</li>\n\n\n\n<li>Langenium Issue #39\n<ul class=\"wp-block-list\">\n<li><a href=\"https://github.com/OpenStudiosCo/Langenium/issues/39\">https://github.com/OpenStudiosCo/Langenium/issues/39</a></li>\n</ul>\n</li>\n\n\n\n<li>ShaderMaterial on Three.js Official Docs\n<ul class=\"wp-block-list\">\n<li><a href=\"https://threejs.org/docs/#api/en/materials/ShaderMaterial\">https://threejs.org/docs/#api/en/materials/ShaderMaterial</a></li>\n</ul>\n</li>\n\n\n\n<li>Voronoi GLSL texture functions\n<ul class=\"wp-block-list\">\n<li><a href=\"https://github.com/kinakomoti-321/Voronoi_textures\">https://github.com/kinakomoti-321/Voronoi_textures</a></li>\n</ul>\n</li>\n\n\n\n<li>Blender Texture Material GLSL source code\n<ul class=\"wp-block-list\">\n<li><a href=\"https://github.com/blender/blender/blob/main/source/blender/gpu/shaders/material/gpu_shader_material_tex_noise.glsl\">https://github.com/blender/blender/blob/main/source/blender/gpu/shaders/material/gpu_shader_material_tex_noise.glsl</a></li>\n</ul>\n</li>\n\n\n\n<li>Voronoise article, explaining how to create voronoi textures with snoise\n<ul class=\"wp-block-list\">\n<li><a href=\"https://iquilezles.org/articles/voronoise\">https://iquilezles.org/articles/voronoise</a></li>\n</ul>\n</li>\n\n\n\n<li>Gradient GLSL Gist, used in the Langenium game engine\n<ul class=\"wp-block-list\">\n<li><a href=\"https://gist.github.com/tgfrerer/1640dd717e3ab1eada9f\">https://gist.github.com/tgfrerer/1640dd717e3ab1eada9f</a></li>\n</ul>\n</li>\n\n\n\n<li>BlenderKit materials used\n<ul class=\"wp-block-list\">\n<li>Procedural Scifi Alien Metal Green, <a href=\"https://www.blenderkit.com/asset-gallery-detail/c23680d6-fde9-441c-bab2-99922f4686bc/\">https://www.blenderkit.com/asset-gallery-detail/c23680d6-fde9-441c-bab2-99922f4686bc/</a></li>\n\n\n\n<li>Procedural Abstract Sci-Fi Panels, <a href=\"https://www.blenderkit.com/asset-gallery-detail/484c0cf9-6ae7-4bb1-801d-8bf40e70e554/\">https://www.blenderkit.com/asset-gallery-detail/484c0cf9-6ae7-4bb1-801d-8bf40e70e554/</a></li>\n\n\n\n<li>Procedural Scifi Greeble, <a href=\"https://www.blenderkit.com/asset-gallery-detail/9430fd1f-a2cd-4df6-ae1d-0ba2ad84b5de/\">https://www.blenderkit.com/asset-gallery-detail/9430fd1f-a2cd-4df6-ae1d-0ba2ad84b5de/</a></li>\n\n\n\n<li>Solar Panel, <a href=\"https://www.blenderkit.com/asset-gallery-detail/e92512fb-12b5-4142-878a-c12a5c9f70a0/\">https://www.blenderkit.com/asset-gallery-detail/e92512fb-12b5-4142-878a-c12a5c9f70a0/</a></li>\n</ul>\n</li>\n</ul>\n\n\n\n<p></p>\n","protected":false},"excerpt":{"rendered":"<p>Introduction to Physically Based Rendering and Shaders Achieving realism in computer graphics requires a phenomenal amount of computing power. In order to reduce that workload, 3D graphics uses techniques like Physically Based Rendering (PBR), which simulates the realistic way that light interacts with surfaces. PBR relies on image-based data which can enhance a surface with [&hellip;]</p>\n","protected":false},"author":3,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[8,7,6,3,5,4],"tags":[],"class_list":["post-33","post","type-post","status-publish","format-standard","hentry","category-blender","category-eleventy","category-game-development","category-threejs","category-web-development","category-webgl"],"_links":{"self":[{"href":"https://portal.openstudios.xyz/wp-json/wp/v2/posts/33"}],"collection":[{"href":"https://portal.openstudios.xyz/wp-json/wp/v2/posts"}],"about":[{"href":"https://portal.openstudios.xyz/wp-json/wp/v2/types/post"}],"author":[{"embeddable":true,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/users/3"}],"replies":[{"embeddable":true,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/comments?post=33"}],"version-history":[{"count":71,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/posts/33/revisions"}],"predecessor-version":[{"id":182,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/posts/33/revisions/182"}],"wp:attachment":[{"href":"https://portal.openstudios.xyz/wp-json/wp/v2/media?parent=33"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/categories?post=33"},{"taxonomy":"post_tag","embeddable":true,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/tags?post=33"}],"curies":[{"name":"wp","href":"https://api.w.org/{rel}","templated":true}]}},{"id":106,"date":"2023-10-27T11:18:00","date_gmt":"2023-10-27T03:18:00","guid":{"rendered":"https://portal.openstudios.xyz/?p=106"},"modified":"2024-09-21T04:48:15","modified_gmt":"2024-09-20T20:48:15","slug":"building-a-cool-3d-website-tips-tricks-and-lessons-learned","status":"publish","type":"post","link":"https://portal.openstudios.xyz/building-a-cool-3d-website-tips-tricks-and-lessons-learned/","title":{"rendered":"Building A Cool 3D website: Tips, Tricks and Lessons Learned"},"content":{"rendered":"<div class=\"wp-block-image\">\n<figure class=\"aligncenter is-resized\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:700/1*o6xfwPdjAcGUyBE5s69iOQ.png\" alt=\"\" style=\"width:844px;height:auto\"/></figure></div>\n\n\n<p id=\"5eb2\">I first learned to make websites back in 1999 using Macromedia software like Dreamweaver, Fireworks and Flash. It was a golden age for vibrant interactive experiences that pushed the boundaries of what to expect and that type of web development is what influences me. As a kid of eleven, it was life changing to be able to make my own graphics, animations and interactive experience all with definitely not warez (hai fbi — did I mention I was a minor at the time). The film The Matrix also just came out and I was learning how to use Linux. What I’m saying is that I’ve always been a nerd.</p>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:460/0*Wz8nmIypjtQCnF61\" alt=\"\"/></figure></div>\n\n\n<p id=\"c7ff\">Learning is a journey that never ends, certainly that’s even more true in the world of games programming where even the most sensible wisdoms might get thrown out the window to achieve a result. Some might find that never ending challenge off-putting, but I love it and think it’s fantastic. For Open Studios new website, we wanted to create a digital experience that represented our creative and technical capabilities as a team. Knowing that pushing up against limitations can sometimes shape and produce the best innovative outcomes in the delivery of any project, we decided to proceed without considering the limits and just design whatever we wanted.</p>\n\n\n\n<p id=\"e37a\">Discussing what our new website would look like, we talked about building a virtual world and settled upon a 3D office. Inspired by experiences with video games like Cyberpunk 2077 and Grand Theft Auto, the idea was that you’ve entered an office and when you go to use a computer in that game world it pans and zooms the viewport to that computer for interaction.</p>\n\n\n\n<p id=\"6e00\">Garrett put together a 3D design reference for me to follow so that I could focus my efforts on the programming side of things. In the end the limitations of what I could do with three.js and as a browser experience pushed me to elevate the final result to new heights — far beyond our original plans. This article is a retrospective of that build.</p>\n\n\n\n<p>https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2Ff8z5XBTd82M%3Ffeature%3Doembed&amp;display_name=YouTube&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3Df8z5XBTd82M&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2Ff8z5XBTd82M%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtubeThis design reference was made in Blender and rendered using Cycles by&nbsp;<a href=\"https://www.linkedin.com/in/garrett-ray-kinder-361ba6a5/\" rel=\"noreferrer noopener\" target=\"_blank\">Garrett Kinder</a>.</p>\n\n\n\n<h1 class=\"wp-block-heading\" id=\"9c79\">Architecture and tech stack</h1>\n\n\n\n<p id=\"5345\">In the past I’ve followed a couple of personal taste choices in my work, most of these came about due to my own journey in the industry. For example I liked the Jade templating language because it was similar to what I liked about Haml back in the Ruby on Rails days. I’ve called this combination of items the “Kettlefish” stack.</p>\n\n\n\n<p id=\"ea5f\">Kettlefish is the combination of the following technologies:</p>\n\n\n\n<ul class=\"wp-block-list\">\n<li>A command line file generating build script</li>\n\n\n\n<li>Rollup as the JS builder</li>\n\n\n\n<li>Pug JS templates (Jade when the project started)</li>\n\n\n\n<li>Stylus as the CSS preprocessing language</li>\n</ul>\n\n\n\n<p id=\"3a3c\">The name is a portmanteau of the phrase “A different kettle of fish” because static HTML generation was very novel at the time. It isn’t anymore and so in the 4 years since I’ve dropped my own builder script (and&nbsp;<a href=\"https://www.npmjs.com/package/kettlefish\" rel=\"noreferrer noopener\" target=\"_blank\">NPM package</a>) in favour of the massive Eleventy ecosystem. So massive I was able to just re-create my Kettlefish stack again inside it.</p>\n\n\n\n<p id=\"60c5\"><strong>HTML templating</strong></p>\n\n\n\n<p id=\"0a49\">Using Pug JS templates I split each page into variants — one that would live on the HTML fallback version of the site and another that would only live inside the virtual computer screen omitting things like header and footer menus. I originally tried to just hide the items in question using JavaScript but as they were loading inside iFrames that was problematic.</p>\n\n\n\n<p id=\"8b6f\">The About us page has a search engine facing HTML only page that is intended to load if the users device doesn’t support Javascript and an iFrame version for loading on the computer screen in the virtual world.</p>\n\n\n\n<p id=\"5e0f\">Here’s a quick rundown of the source files involved:</p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:1006/1*4vfBxszhQ4gBRyialRsRMQ.png\" alt=\"\"/></figure>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:994/1*zfUNaAz6X209MbPsmrJRyw.png\" alt=\"\"/><figcaption class=\"wp-element-caption\">The&nbsp;<a href=\"https://github.com/OpenStudiosCo/openstudios.xyz/tree/master/src/web\" rel=\"noreferrer noopener\" target=\"_blank\"><strong>/src/web/</strong></a><strong>&nbsp;</strong>folder contains Pug files that define the HTML pages that are going to be created, as you can see from the two About us source files Eleventy front matter data controls file output location, SEO fields.&nbsp;<strong>extends</strong>&nbsp;sets the template and&nbsp;<strong>include</strong>&nbsp;the common content source in /src/content/about_us.pug.</figcaption></figure>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:999/1*CZVvUfCA9SGLJqS9eDd9mA.png\" alt=\"\"/></figure>\n\n\n<div class=\"wp-block-image\">\n<figure class=\"aligncenter\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:1009/1*InKm7M9eS1_QHqc-yq6NAA.png\" alt=\"\"/><figcaption class=\"wp-element-caption\"><em>The&nbsp;<a href=\"https://github.com/OpenStudiosCo/openstudios.xyz/tree/master/src/templates\" target=\"_blank\" rel=\"noreferrer noopener\">/src/templates</a>&nbsp;folder contains Pug files that contain common HTML structures such as the main HTML tag, head and body elements, etc. Pictured above are the two templates that power the iFrame and HTML fallback pages.</em></figcaption></figure></div>\n\n\n<p id=\"4c72\"><strong>Javascript builder</strong></p>\n\n\n\n<p id=\"5a19\">I followed the (at the time) latest tutorial for developing with Three.js but that didn’t work with my Rollup configuration. The current recommended builder is&nbsp;<a href=\"https://vitejs.dev/\" rel=\"noreferrer noopener\" target=\"_blank\">Vite</a>&nbsp;but I had issues getting that to work with my WIP code, unfortunately I hadn’t decided to add a builder until I got to prelaunch!</p>\n\n\n\n<p id=\"0f90\">Along to the rescue came&nbsp;<a href=\"https://esbuild.github.io/\" rel=\"noreferrer noopener\" target=\"_blank\">esBuild</a>, somehow having just the right defaults that it required nothing but a default configuration for my setup. This was probably the first positive experience I’ve ever had adopting a new unknown JS builder… I hope other web developers reading this get a sense of just what that means to me cause I’ve definitely had a *bad* time before!</p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:637/1*GIoav_V3xAMVNykWsHDtkg.png\" alt=\"\"/></figure>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:993/1*IwioFnqmem73ns74PPcIAA.png\" alt=\"\"/><figcaption class=\"wp-element-caption\">This is a side by side comparison of my build and watch configuration files for esBuild. In my experience a typical Rollup config is generally twice this size with maybe a couple of addon modules needed. Webpack will have a config magnitudes longer than Rollup. Esbuild just seems to ‘<em>get it’ out of the box.</em></figcaption></figure>\n\n\n\n<p id=\"b092\"><strong>Loading screen</strong></p>\n\n\n\n<p id=\"c169\">As I began to test for performance, it was immediately clear I had to implement some kind of loading screen. People with slow connections would be sitting there with nothing happening if assets were being loaded in and even on my relatively powerful computer I had a slight chug when constantly refreshing the scene from cache.</p>\n\n\n\n<p id=\"f44d\">Turning back to my childhood love of The Matrix, I decided to implement a loading screen inspired by that. It was trivial to sneak in a bit of code into the HTML source that would create that effect before the main virtual office code and it’s dependencies would be loaded asynchronously while the user is distracted by the pretty effect.This video demonstrates a longer loading time by throttling the network speed to a slow 3G connection using Chrome Web Developer Tools</p>\n\n\n\n<h1 class=\"wp-block-heading\" id=\"6abb\">Asset preparation</h1>\n\n\n\n<p id=\"39bc\">In real time 3D it’s best to use simple geometry where possible and so some of the objects in the office scene are nothing more than rectangles with well designed materials. In fact the room itself is just a box with the door programmatically cut out using&nbsp;<a href=\"https://github.com/gkjohnson/three-bvh-csg\" rel=\"noreferrer noopener\" target=\"_blank\">three-bvh-csg</a>.</p>\n\n\n\n<p id=\"a336\">The original models used in the room concept contained too much geometry and so I had to prepare them for the web in Blender first. Using the decimate modifier it was a bit of a trial and error process figuring out just how much detail I could lose while maintaining acceptable visuals.</p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:700/1*tdv72UPkSy_iTHwV17987g.png\" alt=\"\"/><figcaption class=\"wp-element-caption\">This small monstera plant came free from BlenderKit, but still required a bit of work to prepare it for use in a real-time 3D setting like our Three.js website.</figcaption></figure>\n\n\n\n<p id=\"f2d4\">The&nbsp;<a href=\"https://en.wikipedia.org/wiki/GlTF\" rel=\"noreferrer noopener\" target=\"_blank\">glTF</a>&nbsp;file format is recommended by Three.js and when I tried to use anything else I quickly learned why. When using the game industry standard&nbsp;<a href=\"https://en.wikipedia.org/wiki/FBX\" rel=\"noreferrer noopener\" target=\"_blank\">FBX</a>&nbsp;the rendered sizes of different assets was off and somehow their geometry got corrupted. The file sizes were also larger than their glTF counterparts. As the scene cannot begin playing until all the assets are loaded, it was important that their files were as small as possible.</p>\n\n\n\n<p id=\"cc34\">Preparing 3D models for the web reminded me a lot of compressing images for the web back in the dialup internet days. Thankfully we have things like AJAX now so rather than rolling up my visual assets into one giant binary file, they are individually loaded in asynchronously while the loading screen with the Matrix effect plays for the user.</p>\n\n\n\n<p id=\"b668\">You may notice that the original concept and produced website look a bit different, part of how that came about is the options for materials and shaders that each 3D renderer and environment brings to the table. Within Blender the results between just the two renderers Eevee and Cycles vary greatly, and so it also goes when you export your assets from there for use in real time 3D applications like Three.JS or Unreal Engine. Even in the world of film where you have a bit more control, there can often be a big change between the original design and the final result.</p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:1920/1*b4dp_HOTSHoWwEXJarVLrw.png\" alt=\"\"/></figure>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:1909/1*CqlrqrWsjwGYFjJVF-JNsw.png\" alt=\"\"/><figcaption class=\"wp-element-caption\">On the left is the original concept render in Blender Cycles and on the right the Three.JS production result.</figcaption></figure>\n\n\n\n<h1 class=\"wp-block-heading\" id=\"8869\"><strong>Performance optimisation</strong></h1>\n\n\n\n<p id=\"3797\">Perhaps one of the biggest risks and unknowns in a venture like this is how to handle the different devices and their hardware capability. Using the FPS (Frames per second) I was able to monitor the users game session for a few seconds and then scale the visual experience according to what their device was able to render smoothly enough. This worked OK in theory, until tested on actual older devices which just crashed before they could even render a single frame with effects like bloom switched on. Even trying to slowly switch them on one by one didn’t work because those larger effects just cannot work on some settings and crash. Problem!</p>\n\n\n\n<p id=\"f453\">Enter&nbsp;<a href=\"https://www.npmjs.com/package/detect-gpu\" rel=\"noreferrer noopener\" target=\"_blank\">detect-gpu</a>, a great little library containing a lookup table of many common device types and a simple scoring system. Using the score that detect-gpu provides, I was able to implement the logic that decides to switch on the very advanced effects if the device is deemed advanced enough — far preferable to slowing down/crashing peoples devices!</p>\n\n\n\n<p id=\"4f5d\">In the end I ended up with two modes, one that doesn’t use the&nbsp;<a href=\"https://threejs.org/docs/#examples/en/postprocessing/EffectComposer\" rel=\"noreferrer noopener\" target=\"_blank\">effects compositing</a>&nbsp;or anti aliasing and a high end GPU mode that has it all. It became more work than expected because of the way light was calculated in the room — without the bloom effects all the colour and brightness values shift so the non special effects version of the scene has a totally different set of settings in order to maintain visual acuity with the full version.</p>\n\n\n\n<p id=\"0d2b\">The website has a&nbsp;<a href=\"https://openstudios.xyz/?fast=\" rel=\"noreferrer noopener\" target=\"_blank\">manual switch</a>&nbsp;for forcing effects to be off, you can activate it by adding a query string key of “fast”.</p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:2872/1*TKulZK8azmjiQ93OrMFuEA.png\" alt=\"\"/></figure>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:2878/1*3f4NkhjMUmTz9UW0ulJZHw.png\" alt=\"\"/><figcaption class=\"wp-element-caption\">On the left is the low end device variant of the scene without effects like bloom and filmic colour. On the right is the full version.</figcaption></figure>\n\n\n\n<h1 class=\"wp-block-heading\" id=\"7219\">Responsiveness and viewports</h1>\n\n\n\n<p id=\"3f06\">Websites will reflow their content in order to present the best experience for users on different screen sizes. The portrait version of the virtual office was originally completely unusable and so a bit of work went into trying to re-compose the scene around the different possible viewports.</p>\n\n\n\n<p id=\"d98e\">To make life easier with positioning, helpers were added to the scene. The website still has a&nbsp;<a href=\"https://openstudios.xyz/?debug=\" rel=\"noreferrer noopener\" target=\"_blank\">debug mode</a>&nbsp;if you want to have a look.</p>\n\n\n\n<p id=\"ab79\">The result of the responsiveness work is a window resize event listener that changes room depth, moves furniture and changes the camera field of view, position and rotation so that the maximum amount of stuff is visible in a portrait frame — without completely changing the scene.</p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:706/1*2vuekKJBfu1ViNdEd_UuQA.png\" alt=\"\"/></figure>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:1288/1*ylORDHjNqRmllbJBxSPHaA.png\" alt=\"\"/><figcaption class=\"wp-element-caption\">As you might notice when looking carefully at these screenshots, the furniture in the room and the field of view are shifted slightly in order to recompose the scene for portrait and landscape modes. We are also running without effects like bloom or anti aliasing here as my laptop couldn’t handle doing them.</figcaption></figure>\n\n\n\n<h1 class=\"wp-block-heading\" id=\"ad06\">Device testing</h1>\n\n\n\n<p id=\"2023\">While I could load the website on my devices using my wi-fi, it was still important for debugging to have access to a console where I could see errors, run arbitrary commands and observe what happens when I run them without going back and forth between my phone and computer.</p>\n\n\n\n<p id=\"76c7\">Chrome has an excellent built-in&nbsp;<a href=\"https://developer.chrome.com/docs/devtools/remote-debugging/\" rel=\"noreferrer noopener\" target=\"_blank\">remote debugger</a>&nbsp;for Android devices and I made extensive use of that when optimising the performance and viewport responsiveness of the site. Unfortunately I don’t have access to any iOS devices in my home so I had to rely on some online resources to render what that looked like and got feedback from a few people who had a variety of devices.</p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:700/1*vksiIbKlWcqwUwnypyiGaA.png\" alt=\"\"/><figcaption class=\"wp-element-caption\">The Chrome Remote Debugger showing a live feed of my phone’s browser tab on the left and the corresponding console with Langenium engine output on the right.</figcaption></figure>\n\n\n\n<p id=\"010b\">One user with an iPhone 11 wasn’t able to load the website at all due to iOS13 not being able to do ECMAScript 2015. The asset loaders within my code and some of the vendor code relied on Promises so I made the call that anyone with iOS less 14 just has to see the “1999 experience”, which is what we call the HTML fallback in house.</p>\n\n\n\n<h1 class=\"wp-block-heading\" id=\"fe6d\">Scope creep</h1>\n\n\n\n<p id=\"c2f2\">Like any web development project, this one had some scope creep. Two notable ones that added about a month and a half to the project.</p>\n\n\n\n<p id=\"00f7\"><strong>Delay one — Entering the virtual office</strong></p>\n\n\n\n<p id=\"37b9\">When the 3D scene loads on the homepage, that made sense to me because it’s the main door to the office. But say you enter via the “Case studies” page from Google, it’s easy enough for me to detect the page loaded and throw up the correct virtual screen but the delay to get back to reading content felt like an unreasonable disruption to the user journey they were on.</p>\n\n\n\n<p id=\"2d6e\">To address the issue of delays when requesting specific pages, I added an twinkly exit sign that would load in using a miniature Matrix effect in the top right corner. You can see this effect in action if you visit a page like&nbsp;<a href=\"https://openstudios.xyz/about_us.html\" rel=\"noreferrer noopener\" target=\"_blank\">About Us</a>. This small effect took a couple of weeks to get right but the pay off was definitely worth it, creating a more cohesive user experience that demonstrates our absolute finesse and control with their journey.</p>\n\n\n\n<p>https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FLqbtxLtF3Ag&#038;display_name=YouTube&#038;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DLqbtxLtF3Ag&#038;image=http%3A%2F%2Fi.ytimg.com%2Fvi%2FLqbtxLtF3Ag%2Fhqdefault.jpg&#038;key=a19fcc184b9711e1b4764040d3dc5c07&#038;type=text%2Fhtml&#038;schema=google</p>\n\n\n\n<p id=\"2359\"><strong>Delay two — Visual acuity of the 1999 experience</strong></p>\n\n\n\n<p id=\"77f6\">The 1999 experience, or HTML fallback, went through a couple of design iterations. Originally looking more like the menu from an 1950s American diner, we opted for something a bit more modern.</p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:1920/1*uiBCVQqP5MaF2fcNAuplVA.png\" alt=\"\"/></figure>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:3841/1*xlgU3hxWpnSm2sMgP2yS3A.png\" alt=\"\"/><figcaption class=\"wp-element-caption\">V1 of the static website on the left compared to V4 on the right, as you can see a few changes happened between them!</figcaption></figure>\n\n\n\n<p id=\"b6cc\">It can be tricky making the call when to pause a project so that a blocker can be resolved. With our new branding, we started out with the logo and render of the office but didn’t have much in the way of additional graphics we could use on things like social media banners. I made the call the pause the project and worked on a 3D animation we dubbed “Riverside Outrun”.</p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:1920/1*T_TFOjv7dKjIrFJzwcvzOQ.png\" alt=\"\"/></figure>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:3840/1*JJ4FR11pMRw61NzJry9C1Q.png\" alt=\"\"/></figure>\n\n\n\n<p id=\"d7ac\">Producing Riverside Outrun was a lot of fun. I used an old photo of the Perth skyline from before the mining buildings went up and gave it a bit of photomanipulation magic to turn it into a much longer skyline with the right colour profile for our vaporwave aesthetic. This image of the city was used as the skybox for the 3D animation.</p>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:2592/1*VUA-893VO9SfBord970Xyw.jpeg\" alt=\"\"/></figure>\n\n\n\n<figure class=\"wp-block-image\"><img decoding=\"async\" src=\"https://miro.medium.com/v2/resize:fit:5000/1*EhxJZNdhcnYW4A-f9ul0Kg.jpeg\" alt=\"\"/><figcaption class=\"wp-element-caption\">Like the themes of The Matrix, the year 1999 and the Vaporwave Aesthetic itself, using this older photo of the Perth skyline on the left carries on our theme of celebrating the past but with a futuristic twist.</figcaption></figure>\n\n\n\n<p id=\"905c\">The vaporwave aesthetic of the video meshes well with the brand and the virtual office. This additional sprint of creative and visual production ended up giving rise to our new motto “To Another World” so I’m very happy with how it all turned out and am glad I took the time to do that.</p>\n\n\n\n<p>https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FgYr3hbP24sQ%3Ffeature%3Doembed&amp;display_name=YouTube&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DgYr3hbP24sQ&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FgYr3hbP24sQ%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube“To Another World” is kind of like a re-launch trailer for our business, I’m currently working on an extended version that intersplices footage of some of our other work as the car is driving in the night.</p>\n\n\n\n<h1 class=\"wp-block-heading\" id=\"9e4f\">The future</h1>\n\n\n\n<p id=\"995f\">This new website is a platform for us to share the vision of our digital studio with the world. A few things from the original plan didn’t make it to launch — notably a wall of pet photos and a 3D talking cat. We will be adding those features over the months to come.</p>\n\n\n\n<p id=\"cfc9\">As time rolls on, we plan to add more rooms to the experience. The concept is that you are exploring a 3D building that represents our real world studio space but in the digital realm.</p>\n\n\n\n<p id=\"9ea7\">The first version is just our office with our computer workstations but we plan to add other rooms from our studio. The jewellery workshop and its show room are probably going to be the next steps. We also have a crafts room for sewing and studio photography.</p>\n\n\n\n<p id=\"5b0d\">Finally, if you still haven’t seen it, check out the&nbsp;<a href=\"https://openstudios.xyz/\" rel=\"noreferrer noopener\" target=\"_blank\">Open Studios website</a>&nbsp;now!</p>\n","protected":false},"excerpt":{"rendered":"<p>I first learned to make websites back in 1999 using Macromedia software like Dreamweaver, Fireworks and Flash. It was a golden age for vibrant interactive experiences that pushed the boundaries of what to expect and that type of web development is what influences me. As a kid of eleven, it was life changing to be [&hellip;]</p>\n","protected":false},"author":3,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[7,3,5,4],"tags":[],"class_list":["post-106","post","type-post","status-publish","format-standard","hentry","category-eleventy","category-threejs","category-web-development","category-webgl"],"_links":{"self":[{"href":"https://portal.openstudios.xyz/wp-json/wp/v2/posts/106"}],"collection":[{"href":"https://portal.openstudios.xyz/wp-json/wp/v2/posts"}],"about":[{"href":"https://portal.openstudios.xyz/wp-json/wp/v2/types/post"}],"author":[{"embeddable":true,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/users/3"}],"replies":[{"embeddable":true,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/comments?post=106"}],"version-history":[{"count":4,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/posts/106/revisions"}],"predecessor-version":[{"id":155,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/posts/106/revisions/155"}],"wp:attachment":[{"href":"https://portal.openstudios.xyz/wp-json/wp/v2/media?parent=106"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/categories?post=106"},{"taxonomy":"post_tag","embeddable":true,"href":"https://portal.openstudios.xyz/wp-json/wp/v2/tags?post=106"}],"curies":[{"name":"wp","href":"https://api.w.org/{rel}","templated":true}]}}]